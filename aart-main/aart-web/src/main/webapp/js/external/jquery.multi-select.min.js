(function(b){var a={init:function(c){this.settings={disabledClass:"disabled",emptyArray:false,callbackOnInit:false,keepOrder:false};if(c){this.settings=b.extend(this.settings,c)}var d=this;d.hide();d.each(function(){var e=b(this);if(e.next(".ms-container").length==0){e.attr("id",e.attr("id")?e.attr("id"):"ms-"+Math.ceil(Math.random()*1000));var f=b('<div id="ms-'+e.attr("id")+'" class="ms-container"></div>'),n=b('<div class="ms-selectable"></div>'),l=b('<div class="ms-selection"></div>'),j=b('<ul class="ms-list"></ul>'),m=b('<ul class="ms-list"></ul>');if(d.settings.emptyArray){if(e.find("option[value='']").length==0){e.prepend("<option value='' selected='selected'></option>")}else{e.find("option[value='']").attr("selected","selected")}}e.data("settings",d.settings);var g=null,h=null,k=0;e.find("optgroup,option").each(function(){if(b(this).is("optgroup")){g=b(this).attr("label");h="ms-"+e.attr("id")+"-optgroup-"+k;j.append(b('<li class="ms-optgroup-container" id="'+h+'"><ul class="ms-optgroup"><li class="ms-optgroup-label">'+g+"</li></ul></li>"));k++}if(b(this).is("option:not(option[value=''])")){var o=b(this).attr("class")?" "+b(this).attr("class"):"";var q=b('<li class="ms-elem-selectable'+o+'" ms-value="'+b(this).val()+'">'+b(this).text()+"</li>");if(b(this).attr("title")){q.attr("title",b(this).attr("title"))}if(b(this).attr("disabled")||e.attr("disabled")){q.attr("disabled","disabled");q.addClass(d.settings.disabledClass)}q.click(function(){e.multiSelect("select",b(this).attr("ms-value"))});var p=h?j.children("#"+h).find("ul").first():j;p.append(q)}});if(d.settings.selectableHeader){n.append(d.settings.selectableHeader)}n.append(j);if(d.settings.selectedHeader){l.append(d.settings.selectedHeader)}l.append(m);f.append(n);f.append(l);e.after(f);e.find("option:selected").each(function(){e.multiSelect("select",b(this).val(),"init")})}})},refresh:function(){b("#ms-"+b(this).attr("id")).remove();b(this).multiSelect("init",b(this).data("settings"))},select:function(q,c){var d=this,f=d.find('option[value="'+q+'"]'),r=f.text(),k=f.attr("class"),n=f.attr("title");var e=b('<li class="ms-elem-selected'+(k?" "+k:"")+'" ms-value="'+q+'">'+r+"</li>"),h=b("#ms-"+d.attr("id")+" .ms-selectable ul"),p=b("#ms-"+d.attr("id")+" .ms-selection ul"),m=h.children('li[ms-value="'+q+'"]'),s=((!m.hasClass(d.data("settings").disabledClass))||(m.hasClass(d.data("settings").disabledClass)&&c=="init"))&&q!=""&&((c=="init"&&f.attr("selected"))||(c!="init"&&!f.attr("selected")));if(s){var o=m.parent(".ms-optgroup");if(o.length>0){if(o.children(".ms-elem-selectable:not(:hidden)").length==1){o.children(".ms-optgroup-label").hide()}}m.addClass("ms-selected");m.hide();f.attr("selected","selected");if(n){e.attr("title",n)}if(m.hasClass(d.data("settings").disabledClass)){e.addClass(d.data("settings").disabledClass)}else{e.click(function(){d.multiSelect("deselect",b(this).attr("ms-value"))})}var g=p.children(".ms-elem-selected");if(c!="init"&&d.data("settings").keepOrder&&g.length>0){var l=function(t){elems=h.children(".ms-elem-selectable");return(elems.index(elems.closest('[ms-value="'+t+'"]')))};var j=l(e.attr("ms-value"));if(j==0){p.prepend(e)}else{for(i=j-1;i>=0;i--){if(g[i]&&l(b(g[i]).attr("ms-value"))<j){b(g[i]).after(e);break}else{if(i==0){b(g[i]).before(e)}}}}}else{p.append(e)}if(d.find("option[value='']")){d.find("option[value='']").removeAttr("selected")}if(c=="select_all"&&o.children(".ms-elem-selectable").length>0){o.children(".ms-optgroup-label").hide()}if(c!="init"||d.data("settings").callbackOnInit){p.trigger("change");h.trigger("change");if(typeof d.data("settings").afterSelect=="function"&&(c!="init"||d.data("settings").callbackOnInit)){d.data("settings").afterSelect.call(this,q,r)}}}},deselect:function(k){var f=this,j=b("#ms-"+f.attr("id")+" .ms-selection ul"),g=f.find('option[value="'+k+'"]'),e=j.children('li[ms-value="'+k+'"]');if(e){var c=b("#ms-"+f.attr("id")+" .ms-selectable ul"),j=b("#ms-"+f.attr("id")+" .ms-selection ul"),h=c.children('li[ms-value="'+k+'"]'),e=j.children('li[ms-value="'+k+'"]');var d=h.parent(".ms-optgroup");if(d.length>0){d.children(".ms-optgroup-label").addClass("ms-collapse").show();d.children(".ms-elem-selectable:not(.ms-selected)").show()}g.removeAttr("selected");h.show();h.removeClass("ms-selected");e.remove();if(f.data("settings").emptyArray&&j.children("li").length==0){if(f.find("option[value='']")){f.find("option[value='']").attr("selected","selected")}}j.trigger("change");c.trigger("change");if(typeof f.data("settings").afterDeselect=="function"){f.data("settings").afterDeselect.call(this,k,e.text())}}},select_all:function(e){var d=this,c=b("#ms-"+d.attr("id")+" .ms-selectable ul");d.find("option:not(option[value=''])").each(function(){var g=b(this).val();if(e){var f=c.children('li[ms-value="'+g+'"]');if(f.filter(":visible").length>0){d.multiSelect("select",g,"select_all")}}else{d.multiSelect("select",g,"select_all")}})},deselect_all:function(){var c=this;c.find("option:not(option[value=''])").each(function(){c.multiSelect("deselect",b(this).val(),"deselect_all")})}};b.fn.multiSelect=function(c){if(a[c]){return a[c].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof c==="object"||!c){return a.init.apply(this,arguments)}else{if(console.log){console.log("Method "+c+" does not exist on jquery.multiSelect")}}}return false}})(jQuery);