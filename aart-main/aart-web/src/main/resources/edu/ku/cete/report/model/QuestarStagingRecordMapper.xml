<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.ku.cete.report.model.QuestarStagingRecordMapper">
  <resultMap id="BaseResultMap" type="edu.ku.cete.report.domain.QuestarStagingRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="questar_staging_file_id" jdbcType="BIGINT" property="questarStagingFileId" />
    <result column="createdate" jdbcType="TIMESTAMP" property="createDate" />
    <result column="refid" jdbcType="VARCHAR" property="refId" />
    <result column="assessmentadministrationrefid" jdbcType="VARCHAR" property="assessmentAdministrationRefId" />
    <result column="studentpersonalrefid" jdbcType="VARCHAR" property="studentPersonalRefId" />
    <result column="walkin" jdbcType="BIT" property="walkIn" />
    <result column="formnumber" jdbcType="BIGINT" property="formNumber" />
    <result column="districtcode" jdbcType="VARCHAR" property="districtCode" />
    <result column="schoolcode" jdbcType="VARCHAR" property="schoolCode" />
    <result column="subject" jdbcType="VARCHAR" property="subject" />
    <result column="studentfirstname" jdbcType="VARCHAR" property="studentFirstName" />
    <result column="studentlastname" jdbcType="VARCHAR" property="studentLastName" />
    <result column="studentmiddlename" jdbcType="VARCHAR" property="studentMiddleName" />
    <result column="grade" jdbcType="VARCHAR" property="grade" />
    <result column="studentkitenumber" jdbcType="BIGINT" property="studentKiteNumber" />
    <result column="studentid" jdbcType="VARCHAR" property="studentStateId" />
    <result column="studentdateofbirth" jdbcType="TIMESTAMP" property="studentDateOfBirth" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="modifieddate" jdbcType="TIMESTAMP" property="modifiedDate" />
    <result column="batchstatus" jdbcType="VARCHAR" property="batchStatus" />
    <result column="sccode" jdbcType="VARCHAR" property="scCode" />
    <result column="accommodation" jdbcType="VARCHAR" property="accommodation" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    id, questar_staging_file_id, createdate, refid, assessmentadministrationrefid, studentpersonalrefid, 
    walkin, formnumber, districtcode, schoolcode, subject, studentfirstname, studentlastname, 
    studentmiddlename, grade, studentkitenumber, studentid, studentdateofbirth, status, 
    modifieddate, batchstatus, sccode, accommodation
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from questar_staging
    where id = #{id,jdbcType=BIGINT}
  </select>
  <insert id="insert" parameterType="edu.ku.cete.report.domain.QuestarStagingRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
      SELECT nextval('questar_staging_id_seq')
    </selectKey>
    insert into questar_staging (id, questar_staging_file_id, createdate, 
      refid, assessmentadministrationrefid, studentpersonalrefid, 
      walkin, formnumber, districtcode, 
      schoolcode, subject, studentfirstname, 
      studentlastname, studentmiddlename, grade, 
      studentkitenumber, studentid, studentdateofbirth, 
      status, modifieddate, batchstatus, 
      sccode, accommodation)
    values (#{id,jdbcType=BIGINT}, #{questarStagingFileId,jdbcType=BIGINT}, #{createDate,jdbcType=TIMESTAMP}, 
      #{refId,jdbcType=VARCHAR}, #{assessmentAdministrationRefId,jdbcType=VARCHAR}, #{studentPersonalRefId,jdbcType=VARCHAR}, 
      #{walkIn,jdbcType=BIT}, #{formNumber,jdbcType=BIGINT}, #{districtCode,jdbcType=VARCHAR}, 
      #{schoolCode,jdbcType=VARCHAR}, #{subject,jdbcType=VARCHAR}, #{studentFirstName,jdbcType=VARCHAR}, 
      #{studentLastName,jdbcType=VARCHAR}, #{studentMiddleName,jdbcType=VARCHAR}, #{grade,jdbcType=VARCHAR}, 
      #{studentKiteNumber,jdbcType=BIGINT}, #{studentStateId,jdbcType=VARCHAR}, #{studentDateOfBirth,jdbcType=DATE}, 
      #{status,jdbcType=VARCHAR}, #{modifiedDate,jdbcType=TIMESTAMP}, #{batchStatus,jdbcType=VARCHAR}, 
      #{scCode,jdbcType=VARCHAR}, #{accommodation,jdbcType=VARCHAR})
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.report.domain.QuestarStagingRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
      SELECT nextval('questar_staging_id_seq')
    </selectKey>
    insert into questar_staging
    <trim prefix="(" suffix=")" suffixOverrides=",">
      id,
      <if test="questarStagingFileId != null">
        questar_staging_file_id,
      </if>
      <if test="createDate != null">
        createdate,
      </if>
      <if test="refId != null">
        refid,
      </if>
      <if test="assessmentAdministrationRefId != null">
        assessmentadministrationrefid,
      </if>
      <if test="studentPersonalRefId != null">
        studentpersonalrefid,
      </if>
      <if test="walkIn != null">
        walkin,
      </if>
      <if test="formNumber != null">
        formnumber,
      </if>
      <if test="districtCode != null">
        districtcode,
      </if>
      <if test="schoolCode != null">
        schoolcode,
      </if>
      <if test="subject != null">
        subject,
      </if>
      <if test="studentFirstName != null">
        studentfirstname,
      </if>
      <if test="studentLastName != null">
        studentlastname,
      </if>
      <if test="studentMiddleName != null">
        studentmiddlename,
      </if>
      <if test="grade != null">
        grade,
      </if>
      <if test="studentKiteNumber != null">
        studentkitenumber,
      </if>
      <if test="studentStateId != null">
        studentid,
      </if>
      <if test="studentDateOfBirth != null">
        studentdateofbirth,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="modifiedDate != null">
        modifieddate,
      </if>
      <if test="batchStatus != null">
        batchstatus,
      </if>
      <if test="scCode != null">
        sccode,
      </if>
      <if test="accommodation != null">
        accommodation,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{id,jdbcType=BIGINT},
      <if test="questarStagingFileId != null">
        #{questarStagingFileId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null">
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="refId != null">
        #{refId,jdbcType=VARCHAR},
      </if>
      <if test="assessmentAdministrationRefId != null">
        #{assessmentAdministrationRefId,jdbcType=VARCHAR},
      </if>
      <if test="studentPersonalRefId != null">
        #{studentPersonalRefId,jdbcType=VARCHAR},
      </if>
      <if test="walkIn != null">
        #{walkIn,jdbcType=BIT},
      </if>
      <if test="formNumber != null">
        #{formNumber,jdbcType=BIGINT},
      </if>
      <if test="districtCode != null">
        #{districtCode,jdbcType=VARCHAR},
      </if>
      <if test="schoolCode != null">
        #{schoolCode,jdbcType=VARCHAR},
      </if>
      <if test="subject != null">
        #{subject,jdbcType=VARCHAR},
      </if>
      <if test="studentFirstName != null">
        #{studentFirstName,jdbcType=VARCHAR},
      </if>
      <if test="studentLastName != null">
        #{studentLastName,jdbcType=VARCHAR},
      </if>
      <if test="studentMiddleName != null">
        #{studentMiddleName,jdbcType=VARCHAR},
      </if>
      <if test="grade != null">
        #{grade,jdbcType=VARCHAR},
      </if>
      <if test="studentKiteNumber != null">
        #{studentKiteNumber,jdbcType=BIGINT},
      </if>
      <if test="studentStateId != null">
        #{studentStateId,jdbcType=VARCHAR},
      </if>
      <if test="studentDateOfBirth != null">
        #{studentDateOfBirth,jdbcType=DATE},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="modifiedDate != null">
        #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="batchStatus != null">
        #{batchStatus,jdbcType=VARCHAR},
      </if>
      <if test="scCode != null">
        #{scCode,jdbcType=VARCHAR},
      </if>
      <if test="accommodation != null">
        #{accommodation,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="edu.ku.cete.report.domain.QuestarStagingRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    update questar_staging
    <set>
      <if test="questarStagingFileId != null">
        questar_staging_file_id = #{questarStagingFileId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null">
        createdate = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="refId != null">
        refid = #{refId,jdbcType=VARCHAR},
      </if>
      <if test="assessmentAdministrationRefId != null">
        assessmentadministrationrefid = #{assessmentAdministrationRefId,jdbcType=VARCHAR},
      </if>
      <if test="studentPersonalRefId != null">
        studentpersonalrefid = #{studentPersonalRefId,jdbcType=VARCHAR},
      </if>
      <if test="walkIn != null">
        walkin = #{walkIn,jdbcType=BIT},
      </if>
      <if test="formNumber != null">
        formnumber = #{formNumber,jdbcType=BIGINT},
      </if>
      <if test="districtCode != null">
        districtcode = #{districtCode,jdbcType=VARCHAR},
      </if>
      <if test="schoolCode != null">
        schoolcode = #{schoolCode,jdbcType=VARCHAR},
      </if>
      <if test="subject != null">
        subject = #{subject,jdbcType=VARCHAR},
      </if>
      <if test="studentFirstName != null">
        studentfirstname = #{studentFirstName,jdbcType=VARCHAR},
      </if>
      <if test="studentLastName != null">
        studentlastname = #{studentLastName,jdbcType=VARCHAR},
      </if>
      <if test="studentMiddleName != null">
        studentmiddlename = #{studentMiddleName,jdbcType=VARCHAR},
      </if>
      <if test="grade != null">
        grade = #{grade,jdbcType=VARCHAR},
      </if>
      <if test="studentKiteNumber != null">
        studentkitenumber = #{studentKiteNumber,jdbcType=BIGINT},
      </if>
      <if test="studentStateId != null">
        studentid = #{studentStateId,jdbcType=VARCHAR},
      </if>
      <if test="studentDateOfBirth != null">
        studentdateofbirth = #{studentDateOfBirth,jdbcType=DATE},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="modifiedDate != null">
        modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="batchStatus != null">
        batchstatus = #{batchStatus,jdbcType=VARCHAR},
      </if>
      <if test="scCode != null">
        sccode = #{scCode,jdbcType=VARCHAR},
      </if>
      <if test="accommodation != null">
        accommodation = #{accommodation,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="edu.ku.cete.report.domain.QuestarStagingRecord">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Mar 10 13:58:30 CST 2016.
    -->
    update questar_staging
    set questar_staging_file_id = #{questarStagingFileId,jdbcType=BIGINT},
      createdate = #{createDate,jdbcType=TIMESTAMP},
      refid = #{refId,jdbcType=VARCHAR},
      assessmentadministrationrefid = #{assessmentAdministrationRefId,jdbcType=VARCHAR},
      studentpersonalrefid = #{studentPersonalRefId,jdbcType=VARCHAR},
      walkin = #{walkIn,jdbcType=BIT},
      formnumber = #{formNumber,jdbcType=BIGINT},
      districtcode = #{districtCode,jdbcType=VARCHAR},
      schoolcode = #{schoolCode,jdbcType=VARCHAR},
      subject = #{subject,jdbcType=VARCHAR},
      studentfirstname = #{studentFirstName,jdbcType=VARCHAR},
      studentlastname = #{studentLastName,jdbcType=VARCHAR},
      studentmiddlename = #{studentMiddleName,jdbcType=VARCHAR},
      grade = #{grade,jdbcType=VARCHAR},
      studentkitenumber = #{studentKiteNumber,jdbcType=BIGINT},
      studentid = #{studentStateId,jdbcType=VARCHAR},
      studentdateofbirth = #{studentDateOfBirth,jdbcType=DATE},
      status = #{status,jdbcType=VARCHAR},
      modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      batchstatus = #{batchStatus,jdbcType=VARCHAR},
      sccode = #{scCode,jdbcType=VARCHAR},
      accommodation = #{accommodation,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <resultMap extends="BaseResultMap" id="DetailedMap" type="edu.ku.cete.web.QuestarStagingDTO">
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="assessmentrefid" jdbcType="VARCHAR" property="assessmentRefId" />
    <result column="assessmentname" jdbcType="VARCHAR" property="assessmentName" />
    <collection column="questar_staging_id" javaType="ArrayList" ofType="edu.ku.cete.report.domain.QuestarStagingResponse" property="responses">
      <result column="questar_staging_response_id" jdbcType="BIGINT" property="id" />
      <result column="response" jdbcType="VARCHAR" property="response" />
      <result column="itemnumber" jdbcType="BIGINT" property="itemNumber" />
      <result column="itemname" jdbcType="VARCHAR" property="itemName" />
      <result column="intensityhex" jdbcType="CHAR" property="intensityHex" />
    </collection>
  </resultMap>
  
  <select id="getNonProcessed" resultMap="DetailedMap">
    SELECT <include refid="Base_Column_List" />
    FROM questar_staging qs
    WHERE batchstatus = 'TOBEPROCESSED'
    ORDER BY id
    <if test="pageSize != null and offset != null">
	  LIMIT #{pageSize,jdbcType=INTEGER} OFFSET #{offset,jdbcType=INTEGER}
    </if>
  </select>
  
  <select id="getDuplicateCount" parameterType="edu.ku.cete.report.domain.QuestarStagingRecord" resultType="int">
    SELECT COUNT(id)
    FROM questar_staging
    WHERE studentid = #{studentStateId,jdbcType=VARCHAR}
    AND formnumber = #{formNumber,jdbcType=BIGINT}
  </select>
  
  <update id="updateReadyForProcessing" parameterType="map">
    UPDATE questar_staging SET batchstatus = 'TOBEPROCESSED' WHERE status = 'READY'
  </update>
  
  <update id="updateToBeProcessedToProcessed" parameterType="map">
    UPDATE questar_staging SET batchstatus = 'PROCESSED' WHERE batchstatus = 'TOBEPROCESSED'
  </update>
</mapper>