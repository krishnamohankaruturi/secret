<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.ku.cete.model.TaskVariantDao" >
  <resultMap id="BaseResultMap" type="edu.ku.cete.domain.content.TaskVariant" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="externalid" property="externalId" jdbcType="BIGINT" />
    <result column="taskname" property="taskName" jdbcType="VARCHAR" />
    <result column="variantname" property="variantName" jdbcType="VARCHAR" />
    <result column="taskstem" property="taskStem" jdbcType="VARCHAR" />
    <result column="itemdescription" property="itemDescription" jdbcType="VARCHAR" />
    <result column="tasktypeid" property="taskTypeId" jdbcType="BIGINT" />
    <result column="tasklayoutid" property="taskLayoutId" jdbcType="BIGINT" />
    <result column="tasklayoutformatid" property="taskLayoutFormatId" jdbcType="BIGINT" />
    <result column="contentareaid" property="contentAreaId" jdbcType="BIGINT" />
    <result column="gradecourseid" property="gradeCourseId" jdbcType="BIGINT" />
    <result column="testingprogramid" property="testingProgramId" jdbcType="BIGINT" />
    <result column="frameworktypeid" property="frameworkTypeId" jdbcType="BIGINT" />
    <result column="taskdifficultyid" property="taskDifficultyId" jdbcType="BIGINT" />
    <result column="cognitivetaxonomyid" property="cognitiveTaxonomyId" jdbcType="BIGINT" />
    <result column="cognitivetaxonomydimensionid" property="cognitiveTaxonomyDimensionId" jdbcType="BIGINT" />
    <result column="createdate" property="createDate" jdbcType="TIMESTAMP" />
    <result column="modifieddate" property="modifiedDate" jdbcType="TIMESTAMP" />
    <result column="originationcode" property="originationCode" jdbcType="VARCHAR" />
    <result column="version" property="version" jdbcType="INTEGER" />
    <result column="testlet" property="testlet" jdbcType="BIT" />
    <result column="contextstimulusid" property="contextStimulusId" jdbcType="BIGINT" />
    <result column="numberofresponses" property="numberOfResponses" jdbcType="INTEGER" />
    <result column="shuffled" property="shuffled" jdbcType="BIT" />
    <result column="innovativeitempackagepath" property="innovativeItemPackagePath" jdbcType="VARCHAR" />
    <result column="directions" property="directions" jdbcType="VARCHAR" />
    <result column="cue" property="cue" jdbcType="VARCHAR" />
    <result column="completion" property="completion" jdbcType="VARCHAR" />
    <result column="rubricneeded" property="rubricNeeded" jdbcType="BIT" />
    <result column="reporttasklayoutformatid" property="reportTaskLayoutFormatId" jdbcType="BIGINT" />
    <result column="taskvariantposition" property="taskPosition" jdbcType="BIGINT" />
  </resultMap>
  
    <resultMap id="extendResultMap" type="edu.ku.cete.domain.content.TaskVariant" extends="BaseResultMap">
      <result column="response" property="studentResponse" jdbcType="VARCHAR" />
      <collection  property="foilResponse" ofType="edu.ku.cete.domain.content.Foil" javaType="ArrayList"  >  
           <result property="foilText" column="foiltext" jdbcType="VARCHAR"/>
      </collection>    
    </resultMap>
  
  <sql id="Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    <where >
      <foreach collection="oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    <where >
      <foreach collection="example.oredCriteria" item="criteria" separator="or" >
        <if test="criteria.valid" >
          <trim prefix="(" suffix=")" prefixOverrides="and" >
            <foreach collection="criteria.criteria" item="criterion" >
              <choose >
                <when test="criterion.noValue" >
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue" >
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue" >
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue" >
                  and ${criterion.condition}
                  <foreach collection="criterion.value" item="listItem" open="(" close=")" separator="," >
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    id, externalid, taskname, variantname, taskstem, itemdescription, 
    tasktypeid, tasklayoutid, tasklayoutformatid, contentareaid, gradecourseid, testingprogramid, 
    frameworktypeid, taskdifficultyid, cognitivetaxonomyid, cognitivetaxonomydimensionid, 
    createdate, modifieddate, originationcode, version, testlet, contextstimulusid, numberofresponses, 
    shuffled, innovativeitempackagepath, directions, cue, completion, rubricneeded, reporttasklayoutformatid
  </sql>
  
  
      <resultMap id="taskVariantObjectMap" type="edu.ku.cete.domain.content.TestSectionsTaskVariants">
	    <id column="tstv.testsectionid" property="testSectionId" jdbcType="BIGINT" />
	    <id column="tstv.taskvariantid" property="taskVariantId" jdbcType="BIGINT" />
	    <result column="tstv.externaltestsectionid" property="externalTestSectionId" jdbcType="BIGINT" />
	    <result column="tl.externalid" property="testletExternalId" jdbcType="BIGINT" />
	    <result column="tstv.externaltaskid" property="externalTaskId" jdbcType="BIGINT" />
	    <result column="tstv.originationcode" property="originationCode" jdbcType="VARCHAR" />
	    <result column="tstv.taskvariantposition" property="taskVariantPosition" jdbcType="INTEGER" />
        <association property="taskVariant" javaType="edu.ku.cete.domain.content.TaskVariant">
		    <id column="tv.id" property="id" jdbcType="BIGINT" />
		    <result column="tv.externalid" property="externalId" jdbcType="BIGINT" />
		    <result column="tv.taskname" property="taskName" jdbcType="VARCHAR" />
		    <result column="tv.variantname" property="variantName" jdbcType="VARCHAR" />
		    <result column="tv.taskstem" property="taskStem" jdbcType="VARCHAR" />
		    <result column="tv.itemdescription" property="itemDescription" jdbcType="VARCHAR" />
		    <result column="tv.tasktypeid" property="taskTypeId" jdbcType="BIGINT" />
		    <result column="tv.tasklayoutid" property="taskLayoutId" jdbcType="BIGINT" />
		    <result column="tv.tasklayoutformatid" property="taskLayoutFormatId" jdbcType="BIGINT" />
		    <result column="tv.contentareaid" property="contentAreaId" jdbcType="BIGINT" />
		    <result column="tv.gradecourseid" property="gradeCourseId" jdbcType="BIGINT" />
		    <result column="tv.testingprogramid" property="testingProgramId" jdbcType="BIGINT" />
		    <result column="tv.frameworktypeid" property="frameworkTypeId" jdbcType="BIGINT" />
		    <result column="tv.taskdifficultyid" property="taskDifficultyId" jdbcType="BIGINT" />
		    <result column="tv.cognitivetaxonomyid" property="cognitiveTaxonomyId" jdbcType="BIGINT" />
		    <result column="tv.cognitivetaxonomydimensionid" property="cognitiveTaxonomyDimensionId"
		     jdbcType="BIGINT" />
		    <result column="tv.createdate" property="createDate" jdbcType="TIMESTAMP" />
		    <result column="tv.modifieddate" property="modifiedDate" jdbcType="TIMESTAMP" />
		    <result column="tv.originationcode" property="originationCode" jdbcType="VARCHAR" />
		    <result column="tv.version" property="version" jdbcType="INTEGER" />
		    <result column="tv.testlet" property="testlet" jdbcType="BIT" />
		    <result column="tv.contextstimulusid" property="contextStimulusId" jdbcType="BIGINT" />
		    <result column="tv.numberofresponses" property="numberOfResponses" jdbcType="INTEGER" />
		    <result column="tv.shuffled" property="shuffled" jdbcType="BIT" />
		    <result column="tv.innovativeitempackagepath" property="innovativeItemPackagePath" jdbcType="VARCHAR" />
		    <result column="tv.directions" property="directions" jdbcType="VARCHAR" />
		    <result column="tv.cue" property="cue" jdbcType="VARCHAR" />
		    <result column="tv.completion" property="completion" jdbcType="VARCHAR" />
		    <result column="tv.tasktype" property="taskType" jdbcType="VARCHAR" />
		    <result column="tv.tasksubtype" property="taskSubType" jdbcType="VARCHAR" />
		    <result column="tv.scoringdata" property="scoringData" jdbcType="VARCHAR" />
        </association>
    </resultMap>
    
    <sql id="Tv_Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    tstv.testsectionid as "tstv.testsectionid", tstv.taskvariantid as "tstv.taskvariantid", tl.externalid as "tl.externalid",
     tstv.externaltestsectionid as "tstv.externaltestsectionid" , tstv.externaltaskid as "tstv.externaltaskid", tstv.originationcode as "tstv.originationcode", 
    tstv.taskvariantposition as "tstv.taskvariantposition",
    tv.id as "tv.id",tv.externalid as "tv.externalid" ,tv.taskname as "tv.taskname" ,
    tv.variantname as "tv.variantname" ,tv.taskstem as "tv.taskstem" ,
    tv.itemdescription as "tv.itemdescription" ,
    tv.tasktypeid,tv.tasklayoutid,tv.tasklayoutformatid,
    tv.contentareaid,tv.gradecourseid,tv.testingprogramid,
    tv.frameworktypeid,tv.taskdifficultyid,
    tv.cognitivetaxonomyid,tv.cognitivetaxonomydimensionid,
    tv.createdate,tv.modifieddate,
    tv.originationcode,tv.version as "tv.version",tv.testlet,
    tv.contextstimulusid as "tv.contextstimulusid",tv.numberofresponses as "tv.numberofresponses",
    tv.shuffled as "tv.shuffled",tv.innovativeitempackagepath as "tv.innovativeitempackagepath",
    tv.directions as "tv.directions",tv.cue as "tv.cue",tv.completion as "tv.completion",
    tt.code as "tv.tasktype", tst.code as "tv.tasksubtype", tv.scoringdata as "tv.scoringdata"
    </sql>
    
    <select id="selectByTestSection" resultMap="taskVariantObjectMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    select
    <include refid="Tv_Base_Column_List" />
    from public.taskvariant tv 
    join public.TestSectionsTaskVariants tstv on tv.id = tstv.taskvariantid
    join tasktype tt on tv.tasktypeid = tt.id
    LEFT JOIN testlet tl ON tl.id = tstv.testletid
    left join tasksubtype tst on tst.id = tv.tasksubtypeid
	    <if test="testSectionIds != null" >
    		where tstv.testsectionid in
			<foreach collection="testSectionIds" item="testSectionId" open="(" close=")" separator="," >
			#{testSectionId,jdbcType=BIGINT}
			</foreach>
	    </if>
	order by tstv.testsectionid,tstv.taskvariantposition
  </select>

  <select id="selectByExample" resultMap="BaseResultMap" parameterType="edu.ku.cete.domain.content.TaskVariantExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from public.taskvariant
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
    <if test="orderByClause != null" >
      order by ${orderByClause}
    </if>
  </select>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    select 
    <include refid="Base_Column_List" />
    from public.taskvariant
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    delete from public.taskvariant
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <delete id="deleteByExample" parameterType="edu.ku.cete.domain.content.TaskVariantExample" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    delete from public.taskvariant
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </delete>
  <insert id="insert" parameterType="edu.ku.cete.domain.content.TaskVariant" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    insert into public.taskvariant (externalid, taskname, 
      variantname, taskstem, itemdescription, 
      tasktypeid, tasklayoutid, 
      tasklayoutformatid, contentareaid, gradecourseid, 
      testingprogramid, frameworktypeid, taskdifficultyid, 
      cognitivetaxonomyid, cognitivetaxonomydimensionid, 
      createdate, modifieddate, originationcode, 
      version, testlet, contextstimulusid, 
      numberofresponses, shuffled, innovativeitempackagepath, 
      directions, cue, completion
      )
    values (#{externalId,jdbcType=BIGINT}, #{taskName,jdbcType=VARCHAR}, 
      #{variantName,jdbcType=VARCHAR}, #{taskStem,jdbcType=VARCHAR}, #{itemDescription,jdbcType=VARCHAR}, 
      #{taskTypeId,jdbcType=BIGINT}, #{taskLayoutId,jdbcType=BIGINT}, 
      #{taskLayoutFormatId,jdbcType=BIGINT}, #{contentAreaId,jdbcType=BIGINT}, #{gradeCourseId,jdbcType=BIGINT}, 
      #{testingProgramId,jdbcType=BIGINT}, #{frameworkTypeId,jdbcType=BIGINT}, #{taskDifficultyId,jdbcType=BIGINT}, 
      #{cognitiveTaxonomyId,jdbcType=BIGINT}, #{cognitiveTaxonomyDimensionId,jdbcType=BIGINT}, 
      #{createDate,jdbcType=TIMESTAMP}, #{modifiedDate,jdbcType=TIMESTAMP}, #{originationCode,jdbcType=VARCHAR}, 
      #{version,jdbcType=INTEGER}, #{testlet,jdbcType=BIT}, #{contextStimulusId,jdbcType=BIGINT}, 
      #{numberOfResponses,jdbcType=INTEGER}, #{shuffled,jdbcType=BIT}, #{innovativeItemPackagePath,jdbcType=VARCHAR}, 
      #{directions,jdbcType=VARCHAR}, #{cue,jdbcType=VARCHAR}, #{completion,jdbcType=VARCHAR}
      )
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.domain.content.TaskVariant" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    insert into public.taskvariant
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="externalId != null" >
        externalid,
      </if>
      <if test="taskName != null" >
        taskname,
      </if>
      <if test="variantName != null" >
        variantname,
      </if>
      <if test="taskStem != null" >
        taskstem,
      </if>
      <if test="itemDescription != null" >
        itemdescription,
      </if>
      <if test="taskTypeId != null" >
        tasktypeid,
      </if>
      <if test="taskLayoutId != null" >
        tasklayoutid,
      </if>
      <if test="taskLayoutFormatId != null" >
        tasklayoutformatid,
      </if>
      <if test="contentAreaId != null" >
        contentareaid,
      </if>
      <if test="gradeCourseId != null" >
        gradecourseid,
      </if>
      <if test="testingProgramId != null" >
        testingprogramid,
      </if>
      <if test="frameworkTypeId != null" >
        frameworktypeid,
      </if>
      <if test="taskDifficultyId != null" >
        taskdifficultyid,
      </if>
      <if test="cognitiveTaxonomyId != null" >
        cognitivetaxonomyid,
      </if>
      <if test="cognitiveTaxonomyDimensionId != null" >
        cognitivetaxonomydimensionid,
      </if>
      <if test="createDate != null" >
        createdate,
      </if>
      <if test="modifiedDate != null" >
        modifieddate,
      </if>
      <if test="originationCode != null" >
        originationcode,
      </if>
      <if test="version != null" >
        version,
      </if>
      <if test="testlet != null" >
        testlet,
      </if>
      <if test="contextStimulusId != null" >
        contextstimulusid,
      </if>
      <if test="numberOfResponses != null" >
        numberofresponses,
      </if>
      <if test="shuffled != null" >
        shuffled,
      </if>
      <if test="innovativeItemPackagePath != null" >
        innovativeitempackagepath,
      </if>
      <if test="directions != null" >
        directions,
      </if>
      <if test="cue != null" >
        cue,
      </if>
      <if test="completion != null" >
        completion,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="externalId != null" >
        #{externalId,jdbcType=BIGINT},
      </if>
      <if test="taskName != null" >
        #{taskName,jdbcType=VARCHAR},
      </if>
      <if test="variantName != null" >
        #{variantName,jdbcType=VARCHAR},
      </if>
      <if test="taskStem != null" >
        #{taskStem,jdbcType=VARCHAR},
      </if>
      <if test="itemDescription != null" >
        #{itemDescription,jdbcType=VARCHAR},
      </if>
      <if test="taskTypeId != null" >
        #{taskTypeId,jdbcType=BIGINT},
      </if>
      <if test="taskLayoutId != null" >
        #{taskLayoutId,jdbcType=BIGINT},
      </if>
      <if test="taskLayoutFormatId != null" >
        #{taskLayoutFormatId,jdbcType=BIGINT},
      </if>
      <if test="contentAreaId != null" >
        #{contentAreaId,jdbcType=BIGINT},
      </if>
      <if test="gradeCourseId != null" >
        #{gradeCourseId,jdbcType=BIGINT},
      </if>
      <if test="testingProgramId != null" >
        #{testingProgramId,jdbcType=BIGINT},
      </if>
      <if test="frameworkTypeId != null" >
        #{frameworkTypeId,jdbcType=BIGINT},
      </if>
      <if test="taskDifficultyId != null" >
        #{taskDifficultyId,jdbcType=BIGINT},
      </if>
      <if test="cognitiveTaxonomyId != null" >
        #{cognitiveTaxonomyId,jdbcType=BIGINT},
      </if>
      <if test="cognitiveTaxonomyDimensionId != null" >
        #{cognitiveTaxonomyDimensionId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedDate != null" >
        #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="originationCode != null" >
        #{originationCode,jdbcType=VARCHAR},
      </if>
      <if test="version != null" >
        #{version,jdbcType=INTEGER},
      </if>
      <if test="testlet != null" >
        #{testlet,jdbcType=BIT},
      </if>
      <if test="contextStimulusId != null" >
        #{contextStimulusId,jdbcType=BIGINT},
      </if>
      <if test="numberOfResponses != null" >
        #{numberOfResponses,jdbcType=INTEGER},
      </if>
      <if test="shuffled != null" >
        #{shuffled,jdbcType=BIT},
      </if>
      <if test="innovativeItemPackagePath != null" >
        #{innovativeItemPackagePath,jdbcType=VARCHAR},
      </if>
      <if test="directions != null" >
        #{directions,jdbcType=VARCHAR},
      </if>
      <if test="cue != null" >
        #{cue,jdbcType=VARCHAR},
      </if>
      <if test="completion != null" >
        #{completion,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <select id="countByExample" parameterType="edu.ku.cete.domain.content.TaskVariantExample" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    select count(*) from public.taskvariant
    <if test="_parameter != null" >
      <include refid="Example_Where_Clause" />
    </if>
  </select>
  <update id="updateByExampleSelective" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    update public.taskvariant
    <set >
      <if test="record.id != null" >
        id = #{record.id,jdbcType=BIGINT},
      </if>
      <if test="record.externalId != null" >
        externalid = #{record.externalId,jdbcType=BIGINT},
      </if>
      <if test="record.taskName != null" >
        taskname = #{record.taskName,jdbcType=VARCHAR},
      </if>
      <if test="record.variantName != null" >
        variantname = #{record.variantName,jdbcType=VARCHAR},
      </if>
      <if test="record.taskStem != null" >
        taskstem = #{record.taskStem,jdbcType=VARCHAR},
      </if>
      <if test="record.itemDescription != null" >
        itemdescription = #{record.itemDescription,jdbcType=VARCHAR},
      </if>
      <if test="record.taskTypeId != null" >
        tasktypeid = #{record.taskTypeId,jdbcType=BIGINT},
      </if>
      <if test="record.taskLayoutId != null" >
        tasklayoutid = #{record.taskLayoutId,jdbcType=BIGINT},
      </if>
      <if test="record.taskLayoutFormatId != null" >
        tasklayoutformatid = #{record.taskLayoutFormatId,jdbcType=BIGINT},
      </if>
      <if test="record.contentAreaId != null" >
        contentareaid = #{record.contentAreaId,jdbcType=BIGINT},
      </if>
      <if test="record.gradeCourseId != null" >
        gradecourseid = #{record.gradeCourseId,jdbcType=BIGINT},
      </if>
      <if test="record.testingProgramId != null" >
        testingprogramid = #{record.testingProgramId,jdbcType=BIGINT},
      </if>
      <if test="record.frameworkTypeId != null" >
        frameworktypeid = #{record.frameworkTypeId,jdbcType=BIGINT},
      </if>
      <if test="record.taskDifficultyId != null" >
        taskdifficultyid = #{record.taskDifficultyId,jdbcType=BIGINT},
      </if>
      <if test="record.cognitiveTaxonomyId != null" >
        cognitivetaxonomyid = #{record.cognitiveTaxonomyId,jdbcType=BIGINT},
      </if>
      <if test="record.cognitiveTaxonomyDimensionId != null" >
        cognitivetaxonomydimensionid = #{record.cognitiveTaxonomyDimensionId,jdbcType=BIGINT},
      </if>
      <if test="record.createDate != null" >
        createdate = #{record.createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="record.modifiedDate != null" >
        modifieddate = #{record.modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="record.originationCode != null" >
        originationcode = #{record.originationCode,jdbcType=VARCHAR},
      </if>
      <if test="record.version != null" >
        version = #{record.version,jdbcType=INTEGER},
      </if>
      <if test="record.testlet != null" >
        testlet = #{record.testlet,jdbcType=BIT},
      </if>
      <if test="record.contextStimulusId != null" >
        contextstimulusid = #{record.contextStimulusId,jdbcType=BIGINT},
      </if>
      <if test="record.numberOfResponses != null" >
        numberofresponses = #{record.numberOfResponses,jdbcType=INTEGER},
      </if>
      <if test="record.shuffled != null" >
        shuffled = #{record.shuffled,jdbcType=BIT},
      </if>
      <if test="record.innovativeItemPackagePath != null" >
        innovativeitempackagepath = #{record.innovativeItemPackagePath,jdbcType=VARCHAR},
      </if>
      <if test="record.directions != null" >
        directions = #{record.directions,jdbcType=VARCHAR},
      </if>
      <if test="record.cue != null" >
        cue = #{record.cue,jdbcType=VARCHAR},
      </if>
      <if test="record.completion != null" >
        completion = #{record.completion,jdbcType=VARCHAR},
      </if>
    </set>
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByExample" parameterType="map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    update public.taskvariant
    set id = #{record.id,jdbcType=BIGINT},
      externalid = #{record.externalId,jdbcType=BIGINT},
      taskname = #{record.taskName,jdbcType=VARCHAR},
      variantname = #{record.variantName,jdbcType=VARCHAR},
      taskstem = #{record.taskStem,jdbcType=VARCHAR},
      itemdescription = #{record.itemDescription,jdbcType=VARCHAR},
      tasktypeid = #{record.taskTypeId,jdbcType=BIGINT},
      tasklayoutid = #{record.taskLayoutId,jdbcType=BIGINT},
      tasklayoutformatid = #{record.taskLayoutFormatId,jdbcType=BIGINT},
      contentareaid = #{record.contentAreaId,jdbcType=BIGINT},
      gradecourseid = #{record.gradeCourseId,jdbcType=BIGINT},
      testingprogramid = #{record.testingProgramId,jdbcType=BIGINT},
      frameworktypeid = #{record.frameworkTypeId,jdbcType=BIGINT},
      taskdifficultyid = #{record.taskDifficultyId,jdbcType=BIGINT},
      cognitivetaxonomyid = #{record.cognitiveTaxonomyId,jdbcType=BIGINT},
      cognitivetaxonomydimensionid = #{record.cognitiveTaxonomyDimensionId,jdbcType=BIGINT},
      createdate = #{record.createDate,jdbcType=TIMESTAMP},
      modifieddate = #{record.modifiedDate,jdbcType=TIMESTAMP},
      originationcode = #{record.originationCode,jdbcType=VARCHAR},
      version = #{record.version,jdbcType=INTEGER},
      testlet = #{record.testlet,jdbcType=BIT},
      contextstimulusid = #{record.contextStimulusId,jdbcType=BIGINT},
      numberofresponses = #{record.numberOfResponses,jdbcType=INTEGER},
      shuffled = #{record.shuffled,jdbcType=BIT},
      innovativeitempackagepath = #{record.innovativeItemPackagePath,jdbcType=VARCHAR},
      directions = #{record.directions,jdbcType=VARCHAR},
      cue = #{record.cue,jdbcType=VARCHAR},
      completion = #{record.completion,jdbcType=VARCHAR}
    <if test="_parameter != null" >
      <include refid="Update_By_Example_Where_Clause" />
    </if>
  </update>
  <update id="updateByPrimaryKeySelective" parameterType="edu.ku.cete.domain.content.TaskVariant" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    update public.taskvariant
    <set >
      <if test="externalId != null" >
        externalid = #{externalId,jdbcType=BIGINT},
      </if>
      <if test="taskName != null" >
        taskname = #{taskName,jdbcType=VARCHAR},
      </if>
      <if test="variantName != null" >
        variantname = #{variantName,jdbcType=VARCHAR},
      </if>
      <if test="taskStem != null" >
        taskstem = #{taskStem,jdbcType=VARCHAR},
      </if>
      <if test="itemDescription != null" >
        itemdescription = #{itemDescription,jdbcType=VARCHAR},
      </if>
      <if test="taskTypeId != null" >
        tasktypeid = #{taskTypeId,jdbcType=BIGINT},
      </if>
      <if test="taskLayoutId != null" >
        tasklayoutid = #{taskLayoutId,jdbcType=BIGINT},
      </if>
      <if test="taskLayoutFormatId != null" >
        tasklayoutformatid = #{taskLayoutFormatId,jdbcType=BIGINT},
      </if>
      <if test="contentAreaId != null" >
        contentareaid = #{contentAreaId,jdbcType=BIGINT},
      </if>
      <if test="gradeCourseId != null" >
        gradecourseid = #{gradeCourseId,jdbcType=BIGINT},
      </if>
      <if test="testingProgramId != null" >
        testingprogramid = #{testingProgramId,jdbcType=BIGINT},
      </if>
      <if test="frameworkTypeId != null" >
        frameworktypeid = #{frameworkTypeId,jdbcType=BIGINT},
      </if>
      <if test="taskDifficultyId != null" >
        taskdifficultyid = #{taskDifficultyId,jdbcType=BIGINT},
      </if>
      <if test="cognitiveTaxonomyId != null" >
        cognitivetaxonomyid = #{cognitiveTaxonomyId,jdbcType=BIGINT},
      </if>
      <if test="cognitiveTaxonomyDimensionId != null" >
        cognitivetaxonomydimensionid = #{cognitiveTaxonomyDimensionId,jdbcType=BIGINT},
      </if>
      <if test="createDate != null" >
        createdate = #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedDate != null" >
        modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="originationCode != null" >
        originationcode = #{originationCode,jdbcType=VARCHAR},
      </if>
      <if test="version != null" >
        version = #{version,jdbcType=INTEGER},
      </if>
      <if test="testlet != null" >
        testlet = #{testlet,jdbcType=BIT},
      </if>
      <if test="contextStimulusId != null" >
        contextstimulusid = #{contextStimulusId,jdbcType=BIGINT},
      </if>
      <if test="numberOfResponses != null" >
        numberofresponses = #{numberOfResponses,jdbcType=INTEGER},
      </if>
      <if test="shuffled != null" >
        shuffled = #{shuffled,jdbcType=BIT},
      </if>
      <if test="innovativeItemPackagePath != null" >
        innovativeitempackagepath = #{innovativeItemPackagePath,jdbcType=VARCHAR},
      </if>
      <if test="directions != null" >
        directions = #{directions,jdbcType=VARCHAR},
      </if>
      <if test="cue != null" >
        cue = #{cue,jdbcType=VARCHAR},
      </if>
      <if test="completion != null" >
        completion = #{completion,jdbcType=VARCHAR},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="edu.ku.cete.domain.content.TaskVariant" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 08:24:46 CDT 2012.
    -->
    update public.taskvariant
    set externalid = #{externalId,jdbcType=BIGINT},
      taskname = #{taskName,jdbcType=VARCHAR},
      variantname = #{variantName,jdbcType=VARCHAR},
      taskstem = #{taskStem,jdbcType=VARCHAR},
      itemdescription = #{itemDescription,jdbcType=VARCHAR},
      tasktypeid = #{taskTypeId,jdbcType=BIGINT},
      tasklayoutid = #{taskLayoutId,jdbcType=BIGINT},
      tasklayoutformatid = #{taskLayoutFormatId,jdbcType=BIGINT},
      contentareaid = #{contentAreaId,jdbcType=BIGINT},
      gradecourseid = #{gradeCourseId,jdbcType=BIGINT},
      testingprogramid = #{testingProgramId,jdbcType=BIGINT},
      frameworktypeid = #{frameworkTypeId,jdbcType=BIGINT},
      taskdifficultyid = #{taskDifficultyId,jdbcType=BIGINT},
      cognitivetaxonomyid = #{cognitiveTaxonomyId,jdbcType=BIGINT},
      cognitivetaxonomydimensionid = #{cognitiveTaxonomyDimensionId,jdbcType=BIGINT},
      createdate = #{createDate,jdbcType=TIMESTAMP},
      modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      originationcode = #{originationCode,jdbcType=VARCHAR},
      version = #{version,jdbcType=INTEGER},
      testlet = #{testlet,jdbcType=BIT},
      contextstimulusid = #{contextStimulusId,jdbcType=BIGINT},
      numberofresponses = #{numberOfResponses,jdbcType=INTEGER},
      shuffled = #{shuffled,jdbcType=BIT},
      innovativeitempackagepath = #{innovativeItemPackagePath,jdbcType=VARCHAR},
      directions = #{directions,jdbcType=VARCHAR},
      cue = #{cue,jdbcType=VARCHAR},
      completion = #{completion,jdbcType=VARCHAR}
    where id = #{id,jdbcType=BIGINT}
  </update>
  <select id="countByTaskVariantId" parameterType="java.lang.Long" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Oct 18 09:37:45 CDT 2012.
    -->
    select numberofresponses from public.taskvariant 
    where id = #{taskVariantId}
  </select>
  
  <select id="getTestCollectionsByTaskTypeId" resultType="java.lang.Long" >
  	SELECT 
		distinct tc.id 
	FROM testcollection tc 
		JOIN testcollectionstests tct ON tct.testcollectionid = tc.id
		JOIN test t ON t.id = tct.testid
		JOIN testsection ts ON ts.testid = t.id  
		JOIN testsectionstaskvariants tstv ON tstv.testsectionid = ts.id 
		JOIN taskvariant tv ON tv.id = tstv.taskvariantid 
		JOIN tasktype tt ON tt.id = tv.tasktypeid 
	WHERE tc.id in
	<foreach collection="testCollectionIds" item="testCollectionId" open="(" close=")" separator=","  >
	    #{testCollectionId}
    </foreach>
    	AND tt.code = #{taskTypeCode}
  </select>

  <select id="getTestsByTaskTypeId" resultType="java.lang.Long" >
	SELECT 
		distinct t.id 
	FROM test t 
		JOIN testsection ts ON ts.testid = t.id  
		JOIN testsectionstaskvariants tstv ON tstv.testsectionid = ts.id 
		JOIN taskvariant tv ON tv.id = tstv.taskvariantid 
		JOIN tasktype tt ON tt.id = tv.tasktypeid 
	WHERE t.id in
	<foreach collection="testIds" item="testId" open="(" close=")" separator=","  >
		    #{testId}
	</foreach>
		AND tt.code = #{taskTypeCode}
  </select>
  <select id="getTaskTypeCode" parameterType="java.lang.Long" resultType="String">
	  SELECT code 
		FROM tasktype
		WHERE id = #{taskTypeId,jdbcType=BIGINT}
  </select>
  <select id="getTaskTypeCodeByTaskVariant" parameterType="java.lang.Long" resultType="String">
  	SELECT code 
		FROM tasktype
	WHERE id = (SELECT tasktypeid from taskvariant where id =#{taskVariantId,jdbcType=BIGINT})
  </select>
  
  <resultMap id="BaseWithTaskType" extends="BaseResultMap" type="edu.ku.cete.domain.content.TaskVariant">
    <result column="tasktype" property="taskType" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="getTaskVariantsInQuestarGroup" parameterType="int" resultMap="BaseWithTaskType">
	SELECT
		tv.id, tv.externalid, tv.taskname, tv.variantname, tv.taskstem, tv.itemdescription, 
		tv.tasktypeid, tv.tasklayoutid, tv.tasklayoutformatid, tv.contentareaid, tv.gradecourseid, tv.testingprogramid, 
		tv.frameworktypeid, tv.taskdifficultyid, tv.cognitivetaxonomyid, tv.cognitivetaxonomydimensionid, 
		tv.createdate, tv.modifieddate, tv.originationcode, tv.version, tv.testlet, tv.contextstimulusid, tv.numberofresponses, 
		tv.shuffled, tv.innovativeitempackagepath, tv.directions, tv.cue, tv.completion, tv.rubricneeded, tt.code as tasktype,
		tv.reporttasklayoutformatid
    FROM
    	taskvariant tv
    	INNER JOIN studentresponsetaskvariantgroup srtvg ON tv.externalid = srtvg.taskvariantexternalid
    	INNER JOIN tasktype tt ON tv.tasktypeid = tt.id
    		AND tt.code IN
    		<foreach collection="taskTypeCodes" item="taskTypeCode" open="(" close=")" separator=",">
    			#{taskTypeCode,jdbcType=VARCHAR}
    		</foreach>
    WHERE
    	srtvg.groupnumber = #{groupNumber,jdbcType=INTEGER}
  </select>
  
  <select id="getTaskFormatLayoutCharactersById" parameterType="java.lang.Long" resultType="String">
    SELECT formatcharacters FROM tasklayoutformat WHERE id = #{id,jdbcType=BIGINT}
  </select>
  
  <select id="getTaskVariantFoilOrder" parameterType="map" resultType="Integer">
    SELECT responseorder
    FROM taskvariantsfoils
    WHERE taskvariantid = #{taskVariantId,jdbcType=BIGINT}
    AND foilid = #{foilId,jdbcType=BIGINT}
  </select>
  
   <select id="getTaskVariantByExternalIdGradeIdContentId" resultMap="BaseResultMap">
    select tv.*  from taskvariant tv 
	join testsectionstaskvariants tstv on tstv.taskvariantid = tv.id
	join testsection ts on ts.id = tstv.testsectionid
	join test t on t.id = ts.testid
	join testcollectionstests tct on tct.testid = t.id
    join testcollection tc on tc.id = tct.testcollectionid
	join assessmentstestcollections atc on atc.testcollectionid = tct.testcollectionid
	join assessment a on a.id = atc.assessmentid 
	join testingprogram tp on tp.id = a.testingprogramid
	<if test="testingProgramName != null and testingProgramName == 'Interim'">
		join testspecstatementofpurpose tstop on t.testspecificationid=tstop.testspecificationid and tstop.activeflag is true
		join category ct on ct.id=tstop.statementofpurposeid and ct.categorycode='PRDCTN'
	</if>
	where tc.contentareaid = #{contentAreaId,jdbcType=BIGINT}
		and
			case when tc.gradebandid is not null then
				tc.gradebandid in (
					select gbgc.gradebandid
					from gradecourse gc
					join gradebandgradecourse gbgc on gc.id = gbgc.gradecourseid
					where gc.abbreviatedname = #{gradeCourseAbbreviatedName,jdbcType=VARCHAR}
				) 
			else
				tc.gradecourseid in (
					select id
					from gradecourse
					where abbreviatedname = #{gradeCourseAbbreviatedName,jdbcType=VARCHAR}
				)
			end
		and tv.externalid = #{externalId,jdbcType=BIGINT} 
		and tp.assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT} 
		and t.qccomplete is true
		<if test="testingProgramName != null">
			and	tp.programname= #{testingProgramName,jdbcType=VARCHAR}
		</if>
		and t.activeflag = true
  </select>
  
  <resultMap id="BaseWithTaskTypeAndScoringInfo" extends="BaseWithTaskType" type="edu.ku.cete.domain.content.TaskVariant">
    <result column="scoringneeded" property="scoringNeeded" jdbcType="BIT" />
    <result column="scoringmethod" property="scoringMethod" jdbcType="VARCHAR" />
    <result column="scoringdata" property="scoringData" jdbcType="VARCHAR" />
    <result column="maxscore" property="maxScore" jdbcType="INTEGER"/>
    <result column="contentcode" property="contentCode" jdbcType="VARCHAR"/>
    <result column="tasksubtype" property="taskSubType" jdbcType="VARCHAR"/>
    <result column="taskposition" property="taskPosition" jdbcType="INTEGER"/>
  </resultMap>
  
  <select id="getTaskVariantsInSection" parameterType="map" resultMap="BaseWithTaskTypeAndScoringInfo">
 SELECT DISTINCT(tv.id), tv.externalid, tv.taskname, tv.variantname, tv.taskstem, tv.itemdescription, 
		tv.tasktypeid, tv.tasklayoutid, tv.tasklayoutformatid, tv.contentareaid, tv.gradecourseid, tv.testingprogramid, 
		tv.frameworktypeid, tv.taskdifficultyid, tv.cognitivetaxonomyid, tv.cognitivetaxonomydimensionid, 
		tv.createdate, tv.modifieddate, tv.originationcode, tv.version, tv.testlet, tv.contextstimulusid, tv.numberofresponses, 
		tv.shuffled, tv.innovativeitempackagepath, tv.directions, tv.cue, tv.completion, tv.rubricneeded, tt.code as tasktype,
		tv.reporttasklayoutformatid, tv.scoringneeded, tv.scoringmethod, tv.scoringdata, tv.maxscore,tstv.taskvariantposition as taskposition,tst.code as tasksubtype
    FROM testsectionstaskvariants tstv
    INNER JOIN taskvariant tv ON tstv.taskvariantid = tv.id AND tstv.testsectionid = #{testSectionId,jdbcType=BIGINT}
    INNER JOIN tasktype tt ON tv.tasktypeid = tt.id
    LEFT OUTER JOIN tasksubtype tst ON tv.tasksubtypeid=tst.id
    ORDER BY tstv.taskvariantposition
  </select>
  
  
  <select id="getTaskTypeCodeByTaskVariantExternalIdAndTestExternalId" parameterType="map" resultType="String">
    SELECT DISTINCT tt.code
    FROM test t
      INNER JOIN testsection ts ON t.id = ts.testid
      INNER JOIN testsectionstaskvariants tstv ON ts.id = tstv.testsectionid
      INNER JOIN taskvariant tv ON tstv.taskvariantid = tv.id
      INNER JOIN tasktype tt ON tv.tasktypeid = tt.id
    WHERE tv.externalid = #{taskVariantExternalId,jdbcType=BIGINT}
      AND t.id = (SELECT max(id) FROM test WHERE externalid = #{testExternalId,jdbcType=BIGINT})
  </select>
    
  <resultMap id="QuestarTaskvariantMapByExternalId" type="java.util.HashMap" >
     <result property="key" column="externalid"/>
     <collection property="value" javaType="java.util.ArrayList" ofType="java.lang.Long" column="externalid" >
     	<result column="id"/>
     </collection>
  </resultMap>

    <select id="getQuestarTaskvariantMapByExternalId" resultMap="QuestarTaskvariantMapByExternalId">
	  select id, externalid from taskvariant where externalid in 
		(select distinct taskvariantexternalid from studentresponsetaskvariantgroup) order by externalid;
	</select>
	
	<select id="taskvariantCountByTestId"  resultType="java.lang.Integer" >    
	    SELECT Count(*) 
			FROM   taskvariant tv 
			       JOIN testsectionstaskvariants tstv 
			         ON tstv.taskvariantid = tv.id 
			       JOIN testsection tsec 
			         ON tstv.testsectionid = tsec.id 
			       JOIN tasktype tt 
			         ON tv.tasktypeid = tt.id 
			WHERE  tsec.testid = #{testId,jdbcType=BIGINT}    
  	</select>
  
    <!--
	<resultMap id="QuestarTaskvariantMapByExternalId" type="java.util.HashMap">
		<result property="key" column="taskvariantexternalid"/>  
		<collection property="value" javaType="java.util.ArrayList" column="taskvariantexternalid"  
			ofType="java.lang.Long" select="selectTaskVariantsForExternalid"/>  
	</resultMap>  
   
	<select id="getQuestarTaskvariantMapByExternalId" resultMap="QuestarTaskvariantMapByExternalId">  
		select distinct taskvariantexternalid from studentresponsetaskvariantgroup  
	</select>  
   
	<select id="selectTaskVariantsForExternalid" parameterType="java.lang.Long" resultType="java.lang.Long">  
		SELECT id from taskvariant where externalid = #{id}  
	</select>
  -->
  
  <select id="getPromptAndStudentResponse"  resultMap="extendResultMap" > 
			select tv.taskname,sr.response,tv.taskstem,fs.foiltext 
			from taskvariant tv 
			inner join taskvariantsfoils tvf on tv.id = tvf.taskvariantid 
			inner join foil fs on fs.id = tvf.foilid 
			left outer join studentsresponses sr on tv.id = sr.taskvariantid 
			and sr.studentid = #{studentId,jdbcType=BIGINT} and sr.studentstestsid =  #{studentsTestsId,jdbcType=BIGINT}
			where tv.id IN 
			<foreach collection="taskVariantIds" item="taskVariantId" open="(" close=")" separator=",">
    			#{taskVariantId,jdbcType=VARCHAR}
    		</foreach> 		   
  	</select>
  	 
  	<select id="getItemsWithPositionByTestId" resultMap="BaseResultMap">
    select tv.id,
     dense_rank() OVER( partition by ts.testid 
		  order by tstv.testsectionid,tstv.taskvariantposition asc) AS taskvariantposition
		from testsection ts
		inner join testsectionstaskvariants tstv on tstv.testsectionid = ts.id
		inner join taskvariant tv on tv.id = tstv.taskvariantid 
		inner join tasktype tt on tt.id = tv.tasktypeid
		where  ts.testid = #{testId,jdbcType=BIGINT}
  </select>
  
  	<select id="findCountScorableTaskVariants" resultType="java.lang.Integer">
	    select count(distinct tv.id)from testsection ts
			inner join testsectionstaskvariants tstv on tstv.testsectionid = ts.id
			inner join taskvariant tv on tv.id = tstv.taskvariantid 
			inner join tasktype tt on tt.id = tv.tasktypeid
			<if test="ccqScoreId != null" >
        		left join ccqscoreitem cci on tv.id = cci.taskvariantid and cci.activeflag is true 
        		and ccqscoreid =  #{ccqScoreId,jdbcType=BIGINT} 
      		</if>
			where  ts.testid = #{testId,jdbcType=BIGINT} and tt.code in('ER','UDI')
			<if test="ccqScoreId != null" >
				and cci.id is null 
      		</if>
  </select>
</mapper>