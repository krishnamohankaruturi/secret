<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.ku.cete.report.model.KidsDashboardRecordMapper" >
  <resultMap id="BaseResultMap" type="edu.ku.cete.ksde.kids.result.KidsDashboardRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 19 14:04:28 CDT 2017.
    -->
    <result column="id" property="id" jdbcType="BIGINT" />
    <result column="recordtype" property="recordType" jdbcType="VARCHAR" />
    <result column="statestudentidentifier" property="stateStudentIdentifier" jdbcType="VARCHAR" />
    <result column="legallastname" property="legalLastName" jdbcType="VARCHAR" />
    <result column="legalmiddlename" property="legalMiddleName" jdbcType="VARCHAR" />
    <result column="legalfirstname" property="legalFirstName" jdbcType="VARCHAR" />
    <result column="dateofbirth" property="dateOfBirth" jdbcType="TIMESTAMP" />
    <result column="attendanceschoolid" property="attendanceSchoolId" jdbcType="BIGINT" />
    <result column="attendanceschoolidentifier" property="attendanceSchoolIdentifier" jdbcType="VARCHAR" />
    <result column="attendanceschoolname" property="attendanceSchoolName" jdbcType="VARCHAR" />
    <result column="aypschoolid" property="aypSchoolId" jdbcType="BIGINT" />
    <result column="aypschoolidentifier" property="aypSchoolIdentifier" jdbcType="VARCHAR" />
    <result column="aypschoolname" property="aypSchoolName" jdbcType="VARCHAR" />
    <result column="subjectarea" property="subjectArea" jdbcType="VARCHAR" />
    <result column="currentgradelevel" property="currentGradeLevel" jdbcType="VARCHAR" />
    <result column="schoolyear" property="schoolYear" jdbcType="BIGINT" />
    <result column="educatoridentifier" property="educatorIdentifier" jdbcType="VARCHAR" />
    <result column="educatorfirstname" property="educatorFirstName" jdbcType="VARCHAR" />
    <result column="educatorlastname" property="educatorLastName" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="VARCHAR" />
    <result column="reasons" property="reasons" jdbcType="VARCHAR" />
    <result column="messagetype" property="messageType" jdbcType="VARCHAR" />
    <result column="createdate" property="createDate" jdbcType="TIMESTAMP" />
    <result column="modifieddate" property="modifiedDate" jdbcType="TIMESTAMP" />
    <result column="processeddate" property="processedDate" jdbcType="TIMESTAMP" />
    <result column="successfullyprocesseddate" property="successfullyProcessedDate" jdbcType="TIMESTAMP" />
    <result column="recordcommonid" property="recordCommonId" jdbcType="BIGINT" />
  </resultMap>
  <insert id="insert" parameterType="edu.ku.cete.ksde.kids.result.KidsDashboardRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 19 14:04:28 CDT 2017.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE" >
      SELECT nextval('kidsdashboardrecord_id_seq')
    </selectKey>
    insert into kidsdashboardrecord (id, recordtype, statestudentidentifier, 
      legallastname, legalmiddlename, legalfirstname, 
      dateofbirth, attendanceschoolid, attendanceschoolidentifier, 
      attendanceschoolname, aypschoolid, aypschoolidentifier, 
      aypschoolname, subjectarea, currentgradelevel, 
      schoolyear, educatoridentifier, educatorfirstname, 
      educatorlastname, status, reasons, 
      messagetype, createdate, modifieddate, 
      processeddate, successfullyprocesseddate, 
      recordcommonid)
    values (#{id,jdbcType=BIGINT}, #{recordType,jdbcType=VARCHAR}, #{stateStudentIdentifier,jdbcType=VARCHAR}, 
      #{legalLastName,jdbcType=VARCHAR}, #{legalMiddleName,jdbcType=VARCHAR}, #{legalFirstName,jdbcType=VARCHAR}, 
      #{dateOfBirth,jdbcType=DATE}, #{attendanceSchoolId,jdbcType=BIGINT}, #{attendanceSchoolIdentifier,jdbcType=VARCHAR}, 
      #{attendanceSchoolName,jdbcType=VARCHAR}, #{aypSchoolId,jdbcType=BIGINT}, #{aypSchoolIdentifier,jdbcType=VARCHAR}, 
      #{aypSchoolName,jdbcType=VARCHAR}, #{subjectArea,jdbcType=VARCHAR}, #{currentGradeLevel,jdbcType=VARCHAR}, 
      #{schoolYear,jdbcType=BIGINT}, #{educatorIdentifier,jdbcType=VARCHAR}, #{educatorFirstName,jdbcType=VARCHAR}, 
      #{educatorLastName,jdbcType=VARCHAR}, #{status,jdbcType=VARCHAR}, #{reasons,jdbcType=VARCHAR}, 
      #{messageType,jdbcType=VARCHAR}, #{createDate,jdbcType=TIMESTAMP}, #{modifiedDate,jdbcType=TIMESTAMP}, 
      #{processedDate,jdbcType=TIMESTAMP}, #{successfullyProcessedDate,jdbcType=TIMESTAMP}, 
      #{recordCommonId,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.ksde.kids.result.KidsDashboardRecord" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 19 14:04:28 CDT 2017.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE" >
      SELECT nextval('kidsdashboardrecord_id_seq')
    </selectKey>
    insert into kidsdashboardrecord
    <trim prefix="(" suffix=")" suffixOverrides="," >
      id,
      <if test="recordType != null" >
        recordtype,
      </if>
      <if test="stateStudentIdentifier != null" >
        statestudentidentifier,
      </if>
      <if test="legalLastName != null" >
        legallastname,
      </if>
      <if test="legalMiddleName != null" >
        legalmiddlename,
      </if>
      <if test="legalFirstName != null" >
        legalfirstname,
      </if>
      <if test="dateOfBirth != null" >
        dateofbirth,
      </if>
      <if test="attendanceSchoolId != null" >
        attendanceschoolid,
      </if>
      <if test="attendanceSchoolIdentifier != null" >
        attendanceschoolidentifier,
      </if>
      <if test="attendanceSchoolName != null" >
        attendanceschoolname,
      </if>
      <if test="aypSchoolId != null" >
        aypschoolid,
      </if>
      <if test="aypSchoolIdentifier != null" >
        aypschoolidentifier,
      </if>
      <if test="aypSchoolName != null" >
        aypschoolname,
      </if>
      <if test="subjectArea != null" >
        subjectarea,
      </if>
      <if test="currentGradeLevel != null" >
        currentgradelevel,
      </if>
      <if test="schoolYear != null" >
        schoolyear,
      </if>
      <if test="educatorIdentifier != null" >
        educatoridentifier,
      </if>
      <if test="educatorFirstName != null" >
        educatorfirstname,
      </if>
      <if test="educatorLastName != null" >
        educatorlastname,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="reasons != null" >
        reasons,
      </if>
      <if test="messageType != null" >
        messagetype,
      </if>
      <if test="createDate != null" >
        createdate,
      </if>
      <if test="modifiedDate != null" >
        modifieddate,
      </if>
      <if test="processedDate != null" >
        processeddate,
      </if>
      <if test="successfullyProcessedDate != null" >
        successfullyprocesseddate,
      </if>
      <if test="recordCommonId != null" >
        recordcommonid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{id,jdbcType=BIGINT},
      <if test="recordType != null" >
        #{recordType,jdbcType=VARCHAR},
      </if>
      <if test="stateStudentIdentifier != null" >
        #{stateStudentIdentifier,jdbcType=VARCHAR},
      </if>
      <if test="legalLastName != null" >
        #{legalLastName,jdbcType=VARCHAR},
      </if>
      <if test="legalMiddleName != null" >
        #{legalMiddleName,jdbcType=VARCHAR},
      </if>
      <if test="legalFirstName != null" >
        #{legalFirstName,jdbcType=VARCHAR},
      </if>
      <if test="dateOfBirth != null" >
        #{dateOfBirth,jdbcType=DATE},
      </if>
      <if test="attendanceSchoolId != null" >
        #{attendanceSchoolId,jdbcType=BIGINT},
      </if>
      <if test="attendanceSchoolIdentifier != null" >
        #{attendanceSchoolIdentifier,jdbcType=VARCHAR},
      </if>
      <if test="attendanceSchoolName != null" >
        #{attendanceSchoolName,jdbcType=VARCHAR},
      </if>
      <if test="aypSchoolId != null" >
        #{aypSchoolId,jdbcType=BIGINT},
      </if>
      <if test="aypSchoolIdentifier != null" >
        #{aypSchoolIdentifier,jdbcType=VARCHAR},
      </if>
      <if test="aypSchoolName != null" >
        #{aypSchoolName,jdbcType=VARCHAR},
      </if>
      <if test="subjectArea != null" >
        #{subjectArea,jdbcType=VARCHAR},
      </if>
      <if test="currentGradeLevel != null" >
        #{currentGradeLevel,jdbcType=VARCHAR},
      </if>
      <if test="schoolYear != null" >
        #{schoolYear,jdbcType=BIGINT},
      </if>
      <if test="educatorIdentifier != null" >
        #{educatorIdentifier,jdbcType=VARCHAR},
      </if>
      <if test="educatorFirstName != null" >
        #{educatorFirstName,jdbcType=VARCHAR},
      </if>
      <if test="educatorLastName != null" >
        #{educatorLastName,jdbcType=VARCHAR},
      </if>
      <if test="status != null" >
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="reasons != null" >
        #{reasons,jdbcType=VARCHAR},
      </if>
      <if test="messageType != null" >
        #{messageType,jdbcType=VARCHAR},
      </if>
      <if test="createDate != null" >
        #{createDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedDate != null" >
        #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="processedDate != null" >
        #{processedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="successfullyProcessedDate != null" >
        #{successfullyProcessedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="recordCommonId != null" >
        #{recordCommonId,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  
  <select id="getKidsDashboardRecords" resultMap="BaseResultMap">
 		SELECT * FROM kidsdashboardrecord
 			WHERE recordtype = #{recordType}
 				AND successfullyprocesseddate is null
 			 <if test="stateStudentIdentifier != null" >
       			AND statestudentidentifier = #{stateStudentIdentifier,jdbcType=VARCHAR}
     		 </if>
     		 <if test="aypSchoolId != null" >
	        	AND aypschoolid = #{aypSchoolId,jdbcType=BIGINT}
	     	 </if>
     		 <if test="attendanceSchoolId != null" >
	        	AND attendanceschoolid = #{attendanceSchoolId,jdbcType=BIGINT}
	     	 </if> 			 
 			 <if test="subjectArea != null" >
	        	AND subjectarea = #{subjectArea,jdbcType=VARCHAR}
	    	 </if>
	    	 ORDER BY id
  </select>
  
  <update id="updateKidsDashboardRecord" parameterType="edu.ku.cete.ksde.kids.result.KidsDashboardRecord">
  	UPDATE kidsdashboardrecord
  		SET modifieddate = now(),
  			status = #{status},
  			reasons = #{reasons},
  			processeddate = #{processedDate},
  			<if test="successfullyProcessedDate != null">
	  			successfullyprocesseddate = #{successfullyProcessedDate},
  			</if>
  			recordcommonid = #{recordCommonId}
  		WHERE id = #{id}
  </update>
  
  <update id="updateExistingRecordsByTypeSchIdStdId">
  	UPDATE kidsdashboardrecord
  		SET modifieddate = now(),
  			successfullyprocesseddate = now(),
  			recordcommonid = #{recordCommonId}
  		WHERE recordtype = #{recordType}
	  		AND statestudentidentifier = #{stateStudentIdentifier}
	  		AND aypschoolid = #{aypSchoolId}
	  		AND attendanceschoolid = #{attendanceSchoolId}
	  		<if test="subjectArea != null">
	  			AND subjectarea = #{subjectArea}
	  		</if>
  			AND successfullyprocesseddate is null
  </update>
  
   <sql id="findDashBoardMessagesToView">
  	SELECT kd.id, kd.processeddate, kd.statestudentidentifier, kd.legalfirstname, kd.legallastname, kd.legalmiddlename,
  		kd.dateofbirth, kd.recordtype, kd.subjectarea, kd.currentgradelevel, kd.educatoridentifier, kd.educatorlastname,
  		kd.educatorfirstname, kd.messagetype, kd.reasons, aypsch.schoolname as aypschoolname, attsch.schoolname as attendanceschoolname
  	FROM kidsdashboardrecord kd
  	JOIN organizationtreedetail aypsch ON aypsch.schoolid = kd.aypschoolid
  	JOIN organizationtreedetail attsch ON attsch.schoolid = kd.attendanceschoolid
  	WHERE kd.successfullyprocesseddate is null AND attsch.stateid = #{stateId} AND aypsch.stateid = #{stateId}
 	<choose>
  		<when test="ssid != null and ssid != ''">
  			AND kd.statestudentidentifier = #{ssid}
  		</when>
  		<otherwise>
  			AND (attsch.schoolid = #{organizationId} OR attsch.districtid = #{organizationId}  OR attsch.stateid = #{organizationId})
  		</otherwise>	
  	</choose>  
  	
  </sql>
  
  <sql id="findDashBoardMessagesToViewWhere">
  	WHERE 1=1
  	<if test="stateStudentIdentifier != null">AND upper(statestudentidentifier) like upper('%' || #{stateStudentIdentifier} || '%')</if>
  	<if test="legalFirstName != null">AND upper(legalfirstname) like upper('%' || #{legalFirstName} || '%')</if>
  	<if test="legalMiddleName != null">AND upper(legalmiddlename) like upper('%' || #{legalMiddleName} || '%')</if>
  	<if test="legalLastName != null">AND upper(legallastname) like upper('%' || #{legalLastName} || '%')</if>
  	<if test="recordType != null">AND upper(recordtype) like upper('%' || #{recordType} || '%')</if>
  	<if test="attendanceSchoolName != null">AND upper(attendanceschoolname) like upper('%' || #{attendanceSchoolName} || '%')</if>
  	<if test="aypSchoolName != null">AND upper(aypschoolname) like upper('%' || #{aypSchoolName} || '%')</if>
  	<if test="subjectArea != null">AND upper(subjectarea) like upper('%' || #{subjectArea} || '%')</if>
  	<if test="currentGradeLevel != null">AND upper(currentgradelevel) like upper('%' || #{currentGradeLevel} || '%')</if>
  	<if test="educatorIdentifier != null">AND upper(educatorIdentifier) like upper('%' || #{educatorIdentifier} || '%')</if>
  	<if test="educatorFirstName != null">AND upper(educatorfirstname) like upper('%' || #{educatorFirstName} || '%')</if>
  	<if test="educatorLastName != null">AND upper(educatorlastname) like upper('%' || #{educatorLastName} || '%')</if>
  	<if test="messageType != null">AND upper(messagetype) like upper('%' || #{messageType} || '%')</if>  	
  </sql>
  
  <select id="getDashBoardMessagesToView" resultMap="BaseResultMap" parameterType="hashmap"  useCache="false">  	
  	/*NO LOAD BALANCE*/
		SELECT * FROM (<include refid="findDashBoardMessagesToView"/>) AS dashboardmsgs
		<include refid="findDashBoardMessagesToViewWhere"/>
		<if test="sortByColumn != null">
    	ORDER BY 
    		<choose>
	      		<when test="sortByColumn == 'processedDate'">processeddate</when>
	      		<when test="sortByColumn == 'stateStudentIdentifier'">statestudentidentifier</when>
	      		<when test="sortByColumn == 'legalFirstName'">legalfirstname</when>
	      		<when test="sortByColumn == 'legalMiddleName'">legalmiddlename</when>
	      		<when test="sortByColumn == 'legalLastName'">legallastname</when>
	      		<when test="sortByColumn == 'dateOfBirth'">dateofbirth</when>
	      		<when test="sortByColumn == 'recordType'">recordtype</when>
	      		<when test="sortByColumn == 'attendanceSchoolName'">attendanceschoolname</when>
	      		<when test="sortByColumn == 'aypSchoolName'">aypschoolname</when>
	      		<when test="sortByColumn == 'subjectArea'">subjectarea</when>
	      		<when test="sortByColumn == 'currentGradeLevel'">currentgradelevel</when>
	      		<when test="sortByColumn == 'educatorIdentifier'">educatoridentifier</when>
	      		<when test="sortByColumn == 'educatorFirstName'">educatorfirstname</when>
	      		<when test="sortByColumn == 'educatorLastName'">educatorlastname</when>
	      		<when test="sortByColumn == 'messageType'">messagetype</when>
	      		<when test="sortByColumn == 'reasons'">reasons</when>
	      	</choose>
	      	<if test="sortType=='desc'">
    			desc
   	 		</if>
   	 		<if test="sortType=='asc' or sortType==null">
   	 			asc
   	 		</if>
		</if>
		
    	LIMIT #{limit}
    	OFFSET #{offset}
  </select>
  
  <select id="getCountOfDashBoardMessagesToView" resultType="java.lang.Integer" parameterType="hashmap"  useCache="false">
		/*NO LOAD BALANCE*/
   		SELECT count(1) FROM (<include refid="findDashBoardMessagesToView"/>) AS dashboardmsgs
   			<include refid="findDashBoardMessagesToViewWhere"/>
  </select>
  
  <select id="getRecordTypes" resultType="java.lang.String">
  	SELECT DISTINCT kd.recordtype
  	FROM kidsdashboardrecord kd
  	JOIN organizationtreedetail attsch ON attsch.schoolid = kd.attendanceschoolid
  	WHERE kd.successfullyprocesseddate is null  		
  	<choose>
  		<when test="stateStudentIdentifier != null and stateStudentIdentifier != ''">
  			AND kd.statestudentidentifier = #{stateStudentIdentifier}
  		</when>
  		<otherwise>
  			AND (attsch.schoolid = #{organizationId} OR attsch.districtid = #{organizationId} OR attsch.stateid = #{organizationId})
  		</otherwise>	
  	</choose>  	  		  			  			  		
  </select>
  
  <select id="getMessageTypes" resultType="java.lang.String">
  	SELECT DISTINCT kd.messagetype 
  	FROM kidsdashboardrecord kd
  	JOIN organizationtreedetail attsch ON attsch.schoolid = kd.attendanceschoolid
  	WHERE kd.successfullyprocesseddate is null  			
  	<choose>
  		<when test="stateStudentIdentifier != null and stateStudentIdentifier != ''">
  			AND kd.statestudentidentifier = #{stateStudentIdentifier}
  		</when>
  		<otherwise>
  			AND (attsch.schoolid = #{organizationId} OR attsch.districtid = #{organizationId} OR attsch.stateid = #{organizationId})
  		</otherwise>	
  	</choose>
  </select>
  
  <resultMap id="allErrorMessageResultMap" type="edu.ku.cete.ksde.kids.result.KidsAllErrorMessages" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jul 19 14:04:28 CDT 2017.
    -->    
    <result column="recordtype" property="recordType" jdbcType="VARCHAR" />
    <result column="statestudentidentifier" property="stateStudentIdentifier" jdbcType="VARCHAR" />
    <result column="legallastname" property="legalLastName" jdbcType="VARCHAR" />
    <result column="legalmiddlename" property="legalMiddleName" jdbcType="VARCHAR" />
    <result column="legalfirstname" property="legalFirstName" jdbcType="VARCHAR" />
    <result column="dateofbirth" property="dateOfBirth" jdbcType="TIMESTAMP" />       
    <result column="attendanceschoolname" property="attendanceSchoolName" jdbcType="VARCHAR" />       
    <result column="aypschoolname" property="aypSchoolName" jdbcType="VARCHAR" />
    <result column="subjectarea" property="subjectArea" jdbcType="VARCHAR" />
    <result column="currentgradelevel" property="currentGradeLevel" jdbcType="VARCHAR" />   
    <result column="educatoridentifier" property="educatorIdentifier" jdbcType="VARCHAR" />
    <result column="educatorfirstname" property="educatorFirstName" jdbcType="VARCHAR" />
    <result column="educatorlastname" property="educatorLastName" jdbcType="VARCHAR" />
    <result column="reasons" property="reasons" jdbcType="VARCHAR" />
    <result column="messagetype" property="messageType" jdbcType="VARCHAR" />        
    <result column="processeddate" property="processedDate" jdbcType="TIMESTAMP" />    
  </resultMap>
  
  <select id="getAllErrorMessages" resultMap="allErrorMessageResultMap" parameterType="hashmap"  useCache="false">
  		/*NO LOAD BALANCE*/
		SELECT * FROM (<include refid="findDashBoardMessagesToView"/>) AS dashboardmsgs
  </select>
  
  <resultMap type="edu.ku.cete.ksde.kids.result.KidsRecentRecords" id="KidsRecordsMapping">  	
    <result column="createdate" property="createdDate" jdbcType="VARCHAR" />
    <result column="recordtype" property="recordType" jdbcType="VARCHAR" />
    <result column="attendanceschoolname" property="attendanceSchoolName" jdbcType="VARCHAR" />
    <result column="aypschoolname" property="aypSchoolName" jdbcType="VARCHAR" />
    <result column="subjectarea" property="subjectArea" jdbcType="VARCHAR"/>
    <result column="educatoridentifier" property="educatorIdentifier" jdbcType="VARCHAR"/>
  </resultMap>
  
  <sql id="kidsRecords_columns_list">
  	kids.ksdexmlaudit_id as ksdexmlaudit_id, kids.sequence_order sequence_order, kids.create_date AS createdate, kids.record_type AS recordtype, attsch.schoolname as attendanceschoolname,
  	aypsch.schoolname as aypschoolname, '' as subjectarea, '' as educatoridentifier
  </sql>
  
  <sql id="tascRecords_columns_list">
  	tasc.ksdexmlaudit_id   AS ksdexmlaudit_id, tasc.sequence_order  AS sequence_order, tasc.create_date AS createdate, tasc.record_type AS recordtype, 
  	CASE WHEN attsch.schoolname is null THEN aypsch.schoolname ELSE attsch.schoolname END as attendanceschoolname,
  	aypsch.schoolname as aypschoolname, tasc.state_subj_area_code as subjectarea,  tasc.teacher_identifier as educatoridentifier
  </sql>
  
  <select id="geRecentKidsRecord" resultMap="KidsRecordsMapping" parameterType="hashmap">
  	/*NO LOAD BALANCE*/
    select * from (SELECT <include refid="kidsRecords_columns_list" />
    	FROM kids_record_staging as kids
    	JOIN organizationtreedetail attsch on attsch.schooldisplayidentifier = kids.attendance_bldg_no
    	JOIN organizationtreedetail aypsch on aypsch.schooldisplayidentifier = kids.ayp_qpa_bldg_no
		where kids.state_student_identifier = #{stateStudentIdentifier} AND kids.current_school_year = #{currentSchoolYear,jdbcType=VARCHAR}
			AND attsch.stateid = #{stateId} AND aypsch.stateid = #{stateId}
		UNION
		SELECT <include refid="tascRecords_columns_list" />
		FROM tasc_record_staging as tasc
		LEFT JOIN organizationtreedetail attsch on attsch.schooldisplayidentifier = tasc.attendance_bldg_no AND attsch.stateid = #{stateId}
    	JOIN organizationtreedetail aypsch on aypsch.schooldisplayidentifier = tasc.ayp_qpa_bldg_no
		where tasc.state_student_identifier = #{stateStudentIdentifier} AND tasc.current_school_year = #{currentSchoolYear,jdbcType=VARCHAR}
		AND aypsch.stateid = #{stateId}
    ) as kidstascrecords ORDER BY  ksdexmlaudit_id, sequence_order LIMIT 5 
  </select>
</mapper>