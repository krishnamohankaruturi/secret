<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.ku.cete.model.ScoringAssignmentStudentMapper" >
  <resultMap id="BaseResultMap" type="edu.ku.cete.domain.ScoringAssignmentStudent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="studentstestsid" property="studentsTestsId" jdbcType="BIGINT" />
    <result column="studentid" property="studentId" jdbcType="BIGINT" />
    <result column="scoringassignmentid" property="scoringAssignmentId" jdbcType="BIGINT" />
    <result column="createddate" property="createdDate" jdbcType="TIMESTAMP" />
    <result column="createduser" property="createdUser" jdbcType="INTEGER" />
    <result column="activeflag" property="active" jdbcType="BOOLEAN" />
    <result column="kelpascoringstatus" property="kelpaScoringStatus" jdbcType="BIGINT" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    id,studentstestsid, studentid, scoringassignmentid, createddate, createduser, activeflag, kelpascoringstatus 
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from scoringassignmentstudent
    where id = #{id,jdbcType=BIGINT}
  </select>
  <insert id="insert" parameterType="edu.ku.cete.domain.ScoringAssignmentStudent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE" >
      SELECT nextval('scoringassignmentstudent_id_seq')
    </selectKey>
    insert into scoringassignmentstudent (id,studentstestsid, studentid, scoringassignmentid, testid, enrollmentid, 
      createddate, createduser, activeflag,modifieddate,modifieduser
      )
    values (#{id,jdbcType=BIGINT}, #{studentsTestsId,jdbcType=BIGINT}, #{studentId,jdbcType=BIGINT}, #{scoringAssignmentId,jdbcType=BIGINT}, 
      #{testId,jdbcType=BIGINT}, #{enrollmentId,jdbcType=BIGINT}, #{createdDate,jdbcType=TIMESTAMP}, #{createdUser,jdbcType=INTEGER}, #{active,jdbcType=BIT}
      ,#{createdDate,jdbcType=TIMESTAMP}, #{createdUser,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.domain.ScoringAssignmentStudent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    <selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE" >
      SELECT nextval('scoringassignmentstudent_id_seq')
    </selectKey>
    insert into scoringassignmentstudent
    <trim prefix="(" suffix=")" suffixOverrides="," >
      id,
      <if test="studentsTestsId != null" >
        studentstestsid,
      </if>
      <if test="studentId != null" >
        studentid,
      </if>
      <if test="scoringAssignmentId != null" >
        scoringassignmentid,
      </if>
      <if test="createdDate != null" >
        createddate,
      </if>
      <if test="createdUser != null" >
        createduser,
      </if>
      <if test="enrollmentId != null" >
        enrollmentid,
      </if>
       <if test="testId != null" >
        testid,
      </if>
      <if test="active != null" >
        activeflag,
      </if>
      <if test="createdDate != null" >
        modifieddate,
      </if>
      <if test="createdUser != null" >
        modifieduser,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      #{id,jdbcType=BIGINT},
      <if test="studentsTestsId != null" >
        #{studentsTestsId,jdbcType=BIGINT},
      </if>
      <if test="studentId != null" >
        #{studentId,jdbcType=BIGINT},
      </if>
      <if test="scoringAssignmentId != null" >
        #{scoringAssignmentId,jdbcType=BIGINT},
      </if>
      <if test="createdDate != null" >
        #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdUser != null" >
        #{createdUser,jdbcType=INTEGER},
      </if>
      <if test="enrollmentId != null" >
        #{enrollmentId,jdbcType=INTEGER},
      </if>
      <if test="testId != null" >
        #{testId,jdbcType=INTEGER},
      </if>
      <if test="active != null" >
        #{active,jdbcType=BIT},
      </if>
      <if test="createdDate != null" >
        #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdUser != null" >
        #{createdUser,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="edu.ku.cete.domain.ScoringAssignmentStudent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    update scoringassignmentstudent
    <set >
      <if test="studentsTestsId != null" >
        studentstestsid = #{studentsTestsId,jdbcType=BIGINT},
      </if>
      <if test="studentId != null" >
        studentid = #{studentId,jdbcType=BIGINT},
      </if>
      <if test="scoringAssignmentId != null" >
        scoringassignmentid = #{scoringAssignmentId,jdbcType=BIGINT},
      </if>
      <if test="createdDate != null" >
        createddate = #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdUser != null" >
        createduser = #{createdUser,jdbcType=INTEGER},
      </if>
      <if test="active != null" >
        activeflag = #{active,jdbcType=BIT},
      </if>
      <if test="createdUser != null" >
        modifieduser = #{modifiedUser,jdbcType=BIGINT},
      </if>
      modifieddate=now()
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="edu.ku.cete.domain.ScoringAssignmentStudent" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    update scoringassignmentstudent
    set studentstestsid = #{studentsTestsId,jdbcType=BIGINT}, 
      studentid = #{studentId,jdbcType=BIGINT},
      scoringassignmentid = #{scoringAssignmentId,jdbcType=BIGINT},
      createddate = #{createdDate,jdbcType=TIMESTAMP},
      createduser = #{createdUser,jdbcType=INTEGER},
      activeflag = #{active,jdbcType=BIT},
       modifieddate=now(),
       modifieduser = #{modifiedUser,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <select id="getByScoringAssignmentByIdAndstudentTestid" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Mon Sep 21 17:07:36 IST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from scoringassignmentstudent
    where scoringassignmentid =  #{scoringAssignmentId,jdbcType=INTEGER} and  studentstestsid = #{studentsTestId,jdbcType=INTEGER}
  </select>
  
  <update id="deleteByScoringAssignmentByIdAndstudentTestid">
    update scoringassignmentstudent
    set activeflag = false, modifieddate=now(),
       modifieduser = #{modifiedUser,jdbcType=BIGINT}
    where scoringassignmentid =  #{scoringAssignmentId,jdbcType=INTEGER} and  studentstestsid = #{studentsTestId,jdbcType=INTEGER}
  </update>
  
   <select id="getStudentsListByScoringAssignmentId" resultType="java.lang.Long" >
    select 
    studentid
    from scoringassignmentstudent
    where scoringassignmentid =  #{scoringAssignmentId,jdbcType=INTEGER} and activeflag is true
  </select>
  <select id = "getMonitorStageDetails" resultType="java.lang.String">
  		select st.name from scoringassignmentscorer sasc 
			join scoringassignment sa on sa.id = sasc.scoringassignmentid 
			join testsession ts on ts.id = sa.testsessionid
			join stage st on st.id = ts.stageid
			where sasc.id = #{scoringAssignmentScorerId,jdbcType=INTEGER}
  </select> 

 <update id="setKelpaScoringStatus">
    update scoringassignmentstudent
    set kelpascoringstatus = #{statusCode,jdbcType=INTEGER}, modifieddate=now(),
       modifieduser = #{modifiedUser,jdbcType=BIGINT}
    where studentstestsid = #{studentsTestId,jdbcType=INTEGER} and 
    activeflag = true
  </update> 
  
   <update id="updateKelpaScoringStatus">
     update scoringassignmentstudent set kelpascoringstatus = 
     (select distinct kelpascoringstatus from scoringassignmentstudent where studentstestsid = #{studentsTestsId,jdbcType=INTEGER} and kelpascoringstatus is not null 
     and activeflag is true limit 1), modifieddate=now(),modifieduser = #{modifiedUser,jdbcType=BIGINT}
     where studentstestsid = #{studentsTestsId,jdbcType=INTEGER} and activeflag is true	
  </update> 
  
  
  <select id="getStudentByNameAndStudentIdentifier" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from scoringassignmentstudent
    where scoringassignmentid in (select id from scoringassignment where ccqtestname = #{assignmentName} )  
    and  studentid in (select id from student where statestudentidentifier = #{stateStudentId})
    and activeflag is true
  </select>

    <select id="getByStudentsTestId" resultMap="BaseResultMap" >
    select 
    <include refid="Base_Column_List" />
    from scoringassignmentstudent
    where studentstestsid = #{studentsTestsId,jdbcType=INTEGER} and activeflag is true	
  </select>    
</mapper>