<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.ku.cete.report.model.BatchRegistrationMapper">
  <resultMap id="BaseResultMap" type="edu.ku.cete.report.domain.BatchRegistration">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="submissiondate" jdbcType="TIMESTAMP" property="submissionDate" />
    <result column="status" jdbcType="VARCHAR" property="status" />
    <result column="assessmentprogram" jdbcType="BIGINT" property="assessmentProgram" />
    <result column="testingprogram" jdbcType="BIGINT" property="testingProgram" />
    <result column="assessment" jdbcType="BIGINT" property="assessment" />
    <result column="testtype" jdbcType="BIGINT" property="testType" />
    <result column="subject" jdbcType="BIGINT" property="subject" />
    <result column="grade" jdbcType="BIGINT" property="grade" />
    <result column="successcount" jdbcType="INTEGER" property="successCount" />
    <result column="failedcount" jdbcType="INTEGER" property="failedCount" />
    <result column="createddate" jdbcType="TIMESTAMP" property="createdDate" />
    <result column="modifieddate" jdbcType="TIMESTAMP" property="modifiedDate" />
    <result column="createduser" jdbcType="BIGINT" property="createdUser" />
    <result column="contentareaid" jdbcType="BIGINT" property="contentAreaId" />
    <result column="batchtypecode" jdbcType="VARCHAR" property="batchTypeCode" />
    <result column="operationaltestwindowid" jdbcType="BIGINT" property="operationalTestWindowId" />
    <result column="autoenrollmentmethodid" jdbcType="BIGINT" property="autoEnrollmentMethodId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    id, submissiondate, status, assessmentprogram, testingprogram, assessment, testtype, 
    subject, grade, successcount, failedcount, createddate, modifieddate, createduser, 
    contentareaid, batchtypecode, operationaltestwindowid, autoenrollmentmethodid
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    select 
    <include refid="Base_Column_List" />
    from batchregistration
    where id = #{id,jdbcType=BIGINT}
  </select>
  <insert id="insert" parameterType="edu.ku.cete.report.domain.BatchRegistration" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    insert into batchregistration (id, submissiondate, status, 
      assessmentprogram, testingprogram, assessment, 
      testtype, subject, grade, 
      successcount, failedcount, createddate, 
      modifieddate, createduser, contentareaid, 
      batchtypecode, operationaltestwindowid, 
      autoenrollmentmethodid)
    values (#{id,jdbcType=BIGINT}, #{submissionDate,jdbcType=TIMESTAMP}, #{status,jdbcType=VARCHAR}, 
      #{assessmentProgram,jdbcType=BIGINT}, #{testingProgram,jdbcType=BIGINT}, #{assessment,jdbcType=BIGINT}, 
      #{testType,jdbcType=BIGINT}, #{subject,jdbcType=BIGINT}, #{grade,jdbcType=BIGINT}, 
      #{successCount,jdbcType=INTEGER}, #{failedCount,jdbcType=INTEGER}, #{createdDate,jdbcType=TIMESTAMP}, 
      #{modifiedDate,jdbcType=TIMESTAMP}, #{createdUser,jdbcType=BIGINT}, #{contentAreaId,jdbcType=BIGINT}, 
      #{batchTypeCode,jdbcType=VARCHAR}, #{operationalTestWindowId,jdbcType=BIGINT}, 
      #{autoEnrollmentMethodId,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.report.domain.BatchRegistration" useGeneratedKeys="true" keyColumn="id" keyProperty="id">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    insert into batchregistration
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="submissionDate != null">
        submissiondate,
      </if>
      <if test="status != null">
        status,
      </if>
      <if test="assessmentProgram != null">
        assessmentprogram,
      </if>
      <if test="testingProgram != null">
        testingprogram,
      </if>
      <if test="assessment != null">
        assessment,
      </if>
      <if test="testType != null">
        testtype,
      </if>
      <if test="subject != null">
        subject,
      </if>
      <if test="grade != null">
        grade,
      </if>
      <if test="successCount != null">
        successcount,
      </if>
      <if test="failedCount != null">
        failedcount,
      </if>
      <if test="createdDate != null">
        createddate,
      </if>
      <if test="modifiedDate != null">
        modifieddate,
      </if>
      <if test="createdUser != null">
        createduser,
      </if>
      <if test="contentAreaId != null">
        contentareaid,
      </if>
      <if test="batchTypeCode != null">
        batchtypecode,
      </if>
      <if test="operationalTestWindowId != null">
        operationaltestwindowid,
      </if>
      <if test="autoEnrollmentMethodId != null">
        autoenrollmentmethodid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=BIGINT},
      </if>
      <if test="submissionDate != null">
        #{submissionDate,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        #{status,jdbcType=VARCHAR},
      </if>
      <if test="assessmentProgram != null">
        #{assessmentProgram,jdbcType=BIGINT},
      </if>
      <if test="testingProgram != null">
        #{testingProgram,jdbcType=BIGINT},
      </if>
      <if test="assessment != null">
        #{assessment,jdbcType=BIGINT},
      </if>
      <if test="testType != null">
        #{testType,jdbcType=BIGINT},
      </if>
      <if test="subject != null">
        #{subject,jdbcType=BIGINT},
      </if>
      <if test="grade != null">
        #{grade,jdbcType=BIGINT},
      </if>
      <if test="successCount != null">
        #{successCount,jdbcType=INTEGER},
      </if>
      <if test="failedCount != null">
        #{failedCount,jdbcType=INTEGER},
      </if>
      <if test="createdDate != null">
        #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedDate != null">
        #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdUser != null">
        #{createdUser,jdbcType=BIGINT},
      </if>
      <if test="contentAreaId != null">
        #{contentAreaId,jdbcType=BIGINT},
      </if>
      <if test="batchTypeCode != null">
        #{batchTypeCode,jdbcType=VARCHAR},
      </if>
      <if test="operationalTestWindowId != null">
        #{operationalTestWindowId,jdbcType=BIGINT},
      </if>
      <if test="autoEnrollmentMethodId != null">
        #{autoEnrollmentMethodId,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="edu.ku.cete.report.domain.BatchRegistration">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    update batchregistration
    <set>
      <if test="submissionDate != null">
        submissiondate = #{submissionDate,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null">
        status = #{status,jdbcType=VARCHAR},
      </if>
      <if test="assessmentProgram != null">
        assessmentprogram = #{assessmentProgram,jdbcType=BIGINT},
      </if>
      <if test="testingProgram != null">
        testingprogram = #{testingProgram,jdbcType=BIGINT},
      </if>
      <if test="assessment != null">
        assessment = #{assessment,jdbcType=BIGINT},
      </if>
      <if test="testType != null">
        testtype = #{testType,jdbcType=BIGINT},
      </if>
      <if test="subject != null">
        subject = #{subject,jdbcType=BIGINT},
      </if>
      <if test="grade != null">
        grade = #{grade,jdbcType=BIGINT},
      </if>
      <if test="successCount != null">
        successcount = #{successCount,jdbcType=INTEGER},
      </if>
      <if test="failedCount != null">
        failedcount = #{failedCount,jdbcType=INTEGER},
      </if>
      <if test="createdDate != null">
        createddate = #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifiedDate != null">
        modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      </if>
      <if test="createdUser != null">
        createduser = #{createdUser,jdbcType=BIGINT},
      </if>
      <if test="contentAreaId != null">
        contentareaid = #{contentAreaId,jdbcType=BIGINT},
      </if>
      <if test="batchTypeCode != null">
        batchtypecode = #{batchTypeCode,jdbcType=VARCHAR},
      </if>
      <if test="operationalTestWindowId != null">
        operationaltestwindowid = #{operationalTestWindowId,jdbcType=BIGINT},
      </if>
      <if test="autoEnrollmentMethodId != null">
        autoenrollmentmethodid = #{autoEnrollmentMethodId,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="edu.ku.cete.report.domain.BatchRegistration">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Nov 20 17:32:47 CST 2015.
    -->
    update batchregistration
    set submissiondate = #{submissionDate,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=VARCHAR},
      assessmentprogram = #{assessmentProgram,jdbcType=BIGINT},
      testingprogram = #{testingProgram,jdbcType=BIGINT},
      assessment = #{assessment,jdbcType=BIGINT},
      testtype = #{testType,jdbcType=BIGINT},
      subject = #{subject,jdbcType=BIGINT},
      grade = #{grade,jdbcType=BIGINT},
      successcount = #{successCount,jdbcType=INTEGER},
      failedcount = #{failedCount,jdbcType=INTEGER},
      createddate = #{createdDate,jdbcType=TIMESTAMP},
      modifieddate = #{modifiedDate,jdbcType=TIMESTAMP},
      createduser = #{createdUser,jdbcType=BIGINT},
      contentareaid = #{contentAreaId,jdbcType=BIGINT},
      batchtypecode = #{batchTypeCode,jdbcType=VARCHAR},
      operationaltestwindowid = #{operationalTestWindowId,jdbcType=BIGINT},
      autoenrollmentmethodid = #{autoEnrollmentMethodId,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <resultMap extends="BaseResultMap" id="detailinfo" type="edu.ku.cete.domain.BatchRegistrationDTO">  		
  </resultMap>
  
  <select id="getHistory" resultMap="detailinfo">
    select 
    <include refid="Base_Column_List" />
    from batchregistration
	where submissiondate between #{fromDate} and #{toDate} and batchtypecode &lt;&gt; 'BATCHUIJOB'  order by submissiondate desc
	</select>
	
	<select id="selectLatestEnrollmentJobDate" resultType = "java.util.Date">
		    select 
		    submissiondate
		    from batchregistration where autoenrollmentmethodid = #{testEnrollmentMethodId,jdbcType=BIGINT} and status = 'COMPLETED' order by id desc limit 1
	  </select>
	
	<select id="selectLatestJobDate" resultType="java.util.Date">
		SELECT submissiondate
		FROM batchregistration
		WHERE batchtypecode = #{batchTypeCode,jdbcType=VARCHAR}
		AND status = 'COMPLETED'
		ORDER BY id DESC
		LIMIT 1
	</select>
</mapper>