<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.ku.cete.model.SubscoreRawToScaleScoresMapper">
  <resultMap id="BaseResultMap" type="edu.ku.cete.domain.report.SubscoreRawToScaleScores">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    <id column="id" jdbcType="BIGINT" property="id" />
    <result column="schoolyear" jdbcType="BIGINT" property="schoolYear" />
    <result column="assessmentprogramid" jdbcType="BIGINT" property="assessmentProgramId" />
    <result column="subjectid" jdbcType="BIGINT" property="subjectId" />
    <result column="gradeid" jdbcType="BIGINT" property="gradeId" />
    <result column="testid1" jdbcType="BIGINT" property="testId1" />
    <result column="testid2" jdbcType="BIGINT" property="testId2" />
    <result column="subscoredefinitionname" jdbcType="VARCHAR" property="subScoreDefinitionName" />
    <result column="rawscore" jdbcType="NUMERIC" property="rawScore" />
    <result column="batchuploadid" jdbcType="BIGINT" property="batchUploadId" />
    <result column="createddate" jdbcType="TIMESTAMP" property="createdDate" />
    <result column="testid3" jdbcType="BIGINT" property="testId3" />
    <result column="testid4" jdbcType="BIGINT" property="testId4" />
    <result column="rating" jdbcType="INTEGER" property="rating" />
    <result column="minimumpercentresponses" jdbcType="NUMERIC" property="minimumPercentResponses" />
    <result column="performancetestid" jdbcType="BIGINT" property="performanceTestId" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    id, schoolyear, assessmentprogramid, subjectid, gradeid, testid1, testid2, subscoredefinitionname, 
    rawscore, batchuploadid, createddate, testid3, testid4, rating, minimumpercentresponses, 
    performancetestid
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    select 
    <include refid="Base_Column_List" />
    from subscoresrawtoscale
    where id = #{id,jdbcType=BIGINT}
  </select>
  <insert id="insert" parameterType="edu.ku.cete.domain.report.SubscoreRawToScaleScores">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
      SELECT nextval('subscoresrawtoscale_id_seq')
    </selectKey>
    insert into subscoresrawtoscale (id, schoolyear, assessmentprogramid, 
      subjectid, gradeid, testid1, 
      testid2, subscoredefinitionname, rawscore, 
      batchuploadid, createddate, testid3, 
      testid4, rating, minimumpercentresponses, 
      performancetestid)
    values (#{id,jdbcType=BIGINT}, #{schoolYear,jdbcType=BIGINT}, #{assessmentProgramId,jdbcType=BIGINT}, 
      #{subjectId,jdbcType=BIGINT}, #{gradeId,jdbcType=BIGINT}, #{testId1,jdbcType=BIGINT}, 
      #{testId2,jdbcType=BIGINT}, #{subScoreDefinitionName,jdbcType=VARCHAR}, #{rawScore,jdbcType=NUMERIC}, 
      #{batchUploadId,jdbcType=BIGINT}, #{createdDate,jdbcType=TIMESTAMP}, #{testId3,jdbcType=BIGINT}, 
      #{testId4,jdbcType=BIGINT}, #{rating,jdbcType=INTEGER}, #{minimumPercentResponses,jdbcType=NUMERIC}, 
      #{performanceTestId,jdbcType=BIGINT})
  </insert>
  <insert id="insertSelective" parameterType="edu.ku.cete.domain.report.SubscoreRawToScaleScores">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    <selectKey keyProperty="id" order="BEFORE" resultType="java.lang.Long">
      SELECT nextval('subscoresrawtoscale_id_seq')
    </selectKey>
    insert into subscoresrawtoscale
    <trim prefix="(" suffix=")" suffixOverrides=",">
      id,
      <if test="schoolYear != null">
        schoolyear,
      </if>
      <if test="assessmentProgramId != null">
        assessmentprogramid,
      </if>
      <if test="subjectId != null">
        subjectid,
      </if>
      <if test="gradeId != null">
        gradeid,
      </if>
      <if test="testId1 != null">
        testid1,
      </if>
      <if test="testId2 != null">
        testid2,
      </if>
      <if test="subScoreDefinitionName != null">
        subscoredefinitionname,
      </if>
      <if test="rawScore != null">
        rawscore,
      </if>
      <if test="batchUploadId != null">
        batchuploadid,
      </if>
      <if test="createdDate != null">
        createddate,
      </if>
      <if test="testId3 != null">
        testid3,
      </if>
      <if test="testId4 != null">
        testid4,
      </if>
      <if test="rating != null">
        rating,
      </if>
      <if test="minimumPercentResponses != null">
        minimumpercentresponses,
      </if>
      <if test="performanceTestId != null">
        performancetestid,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      #{id,jdbcType=BIGINT},
      <if test="schoolYear != null">
        #{schoolYear,jdbcType=BIGINT},
      </if>
      <if test="assessmentProgramId != null">
        #{assessmentProgramId,jdbcType=BIGINT},
      </if>
      <if test="subjectId != null">
        #{subjectId,jdbcType=BIGINT},
      </if>
      <if test="gradeId != null">
        #{gradeId,jdbcType=BIGINT},
      </if>
      <if test="testId1 != null">
        #{testId1,jdbcType=BIGINT},
      </if>
      <if test="testId2 != null">
        #{testId2,jdbcType=BIGINT},
      </if>
      <if test="subScoreDefinitionName != null">
        #{subScoreDefinitionName,jdbcType=VARCHAR},
      </if>
      <if test="rawScore != null">
        #{rawScore,jdbcType=NUMERIC},
      </if>
      <if test="batchUploadId != null">
        #{batchUploadId,jdbcType=BIGINT},
      </if>
      <if test="createdDate != null">
        #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="testId3 != null">
        #{testId3,jdbcType=BIGINT},
      </if>
      <if test="testId4 != null">
        #{testId4,jdbcType=BIGINT},
      </if>
      <if test="rating != null">
        #{rating,jdbcType=INTEGER},
      </if>
      <if test="minimumPercentResponses != null">
        #{minimumPercentResponses,jdbcType=NUMERIC},
      </if>
      <if test="performanceTestId != null">
        #{performanceTestId,jdbcType=BIGINT},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="edu.ku.cete.domain.report.SubscoreRawToScaleScores">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    update subscoresrawtoscale
    <set>
      <if test="schoolYear != null">
        schoolyear = #{schoolYear,jdbcType=BIGINT},
      </if>
      <if test="assessmentProgramId != null">
        assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT},
      </if>
      <if test="subjectId != null">
        subjectid = #{subjectId,jdbcType=BIGINT},
      </if>
      <if test="gradeId != null">
        gradeid = #{gradeId,jdbcType=BIGINT},
      </if>
      <if test="testId1 != null">
        testid1 = #{testId1,jdbcType=BIGINT},
      </if>
      <if test="testId2 != null">
        testid2 = #{testId2,jdbcType=BIGINT},
      </if>
      <if test="subScoreDefinitionName != null">
        subscoredefinitionname = #{subScoreDefinitionName,jdbcType=VARCHAR},
      </if>
      <if test="rawScore != null">
        rawscore = #{rawScore,jdbcType=NUMERIC},
      </if>
      <if test="batchUploadId != null">
        batchuploadid = #{batchUploadId,jdbcType=BIGINT},
      </if>
      <if test="createdDate != null">
        createddate = #{createdDate,jdbcType=TIMESTAMP},
      </if>
      <if test="testId3 != null">
        testid3 = #{testId3,jdbcType=BIGINT},
      </if>
      <if test="testId4 != null">
        testid4 = #{testId4,jdbcType=BIGINT},
      </if>
      <if test="rating != null">
        rating = #{rating,jdbcType=INTEGER},
      </if>
      <if test="minimumPercentResponses != null">
        minimumpercentresponses = #{minimumPercentResponses,jdbcType=NUMERIC},
      </if>
      <if test="performanceTestId != null">
        performancetestid = #{performanceTestId,jdbcType=BIGINT},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="edu.ku.cete.domain.report.SubscoreRawToScaleScores">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Thu Apr 07 12:42:12 CDT 2016.
    -->
    update subscoresrawtoscale
    set schoolyear = #{schoolYear,jdbcType=BIGINT},
      assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT},
      subjectid = #{subjectId,jdbcType=BIGINT},
      gradeid = #{gradeId,jdbcType=BIGINT},
      testid1 = #{testId1,jdbcType=BIGINT},
      testid2 = #{testId2,jdbcType=BIGINT},
      subscoredefinitionname = #{subScoreDefinitionName,jdbcType=VARCHAR},
      rawscore = #{rawScore,jdbcType=NUMERIC},
      batchuploadid = #{batchUploadId,jdbcType=BIGINT},
      createddate = #{createdDate,jdbcType=TIMESTAMP},
      testid3 = #{testId3,jdbcType=BIGINT},
      testid4 = #{testId4,jdbcType=BIGINT},
      rating = #{rating,jdbcType=INTEGER},
      minimumpercentresponses = #{minimumPercentResponses,jdbcType=NUMERIC},
      performancetestid = #{performanceTestId,jdbcType=BIGINT}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <delete id="deleteAll">
    delete from subscoresrawtoscale
      <if test="schoolYear != null">
    	where schoolyear = #{schoolYear,jdbcType=BIGINT}
     </if>
  </delete>
  
  <delete id="deleteSubscoreRawToScaleScores">
    delete from subscoresrawtoscale
    where assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT} and subjectid = #{subjectId,jdbcType=BIGINT}
    <if test="schoolYear != null">
    	and schoolyear = #{schoolYear,jdbcType=BIGINT}
     </if>
  </delete>
  
  <select id="checkIfSubscoreDefinitionNameExists" resultType="java.lang.Integer">
   	select count(*)
   	from subscoreframework
   	where assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT} 
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		and subscoredefinitionname = #{subScoreDefinitionName,jdbcType=VARCHAR}
  </select>
  
  <select id="getDistinctSubscoreMapping" resultType="java.lang.String">
   	select distinct subscoredefinitionname
   	from subscoresrawtoscale
   	where assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT} 
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		and (testid1= #{testId,jdbcType=BIGINT} or testid2= #{testId,jdbcType=BIGINT})
  </select>
  
  <select id="selectDistinctTestIds" resultType="java.lang.Long">
   	select DISTINCT TESTID1 from subscoresrawtoscale 
   		where TESTID1 is not null 
   		and assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT}
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		<if test="schoolYear!=null">
		  	and schoolyear = #{schoolYear,jdbcType=BIGINT}
		</if>
	UNION
	select DISTINCT TESTID2 from subscoresrawtoscale 
		where TESTID2 is not null
		and assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT}
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		<if test="schoolYear!=null">
	  		and schoolyear = #{schoolYear,jdbcType=BIGINT}
	 	</if>
	UNION
	select DISTINCT TESTID3 from subscoresrawtoscale 
		where TESTID3 is not null
		and assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT}
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		<if test="schoolYear!=null">
	  		and schoolyear = #{schoolYear,jdbcType=BIGINT}
	 	</if>
	UNION
	select DISTINCT TESTID4 from subscoresrawtoscale 
		where TESTID4 is not null
		and assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT}
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		<if test="schoolYear!=null">
	  		and schoolyear = #{schoolYear,jdbcType=BIGINT}
	 	</if>
	UNION
	select DISTINCT performancetestid from subscoresrawtoscale 
		where performancetestid is not null
		and assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT}
   		and subjectid = #{subjectId,jdbcType=BIGINT}
   		and gradeid = #{gradeId,jdbcType=BIGINT}
   		<if test="schoolYear!=null">
	  		and schoolyear = #{schoolYear,jdbcType=BIGINT}
	 	</if>
  </select>
  
  <select id="getRatingForSubscoreRawScore" resultMap="BaseResultMap">
	  select * from subscoresrawtoscale
	   where assessmentprogramid = #{assessmentProgramId,jdbcType=BIGINT} 
	   and subjectid = #{subjectId,jdbcType=BIGINT} 
	   and gradeid = #{gradeId,jdbcType=BIGINT}
	   and schoolyear = #{schoolYear,jdbcType=BIGINT}
	   and upper(subscoredefinitionname) = upper(#{subScoreDefinitionName,jdbcType=VARCHAR})
	   <if test="testId1 != null">
        and testid1 = ANY(Array
	   <foreach close="]" collection="testIds" item="testId" open="[" separator=",">
				#{testId}
		</foreach>
		)
	   </if>
	   <if test="testId2 != null">
	        and testid2 = ANY(Array
	         <foreach close="]" collection="testIds" item="testId" open="[" separator=",">
				#{testId}
			</foreach>
			)
	   </if>
	   <if test="testId3 != null">
	      and testid3 = ANY(Array
	         <foreach close="]" collection="testIds" item="testId" open="[" separator=",">
				#{testId}
			</foreach>
			)
	   </if>
	   <if test="testId4 != null">
	      and testid4 = ANY(Array
	         <foreach close="]" collection="testIds" item="testId" open="[" separator=",">
				#{testId}
			</foreach>
			)
	   </if>
	   <if test="performanceTestId != null">
	       and performancetestid = #{performanceTestId,jdbcType=BIGINT} 
	   </if> 
	   <if test="rawScore != null">
	   	  	and rawscore = #{rawScore,jdbcType=NUMERIC} 
	   </if> 
	   <if test="testId2 == null">
	   		and testid2 is null
	   </if>
	   
	   <if test="testId3 == null">
	   		and testid3 is null
	   </if>
	   
	   <if test="testId4 == null">
	   		and testid4 is null
	   </if>
	   <if test="performanceTestId == null">
	   	and performancetestid is null
	   </if>  
	     	
	    limit 1   
 
  </select>
  
</mapper>