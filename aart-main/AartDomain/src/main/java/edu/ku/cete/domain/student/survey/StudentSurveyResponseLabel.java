package edu.ku.cete.domain.student.survey;

import java.util.Map;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.util.StringUtils;

public class StudentSurveyResponseLabel {
    private static final String TEXT = "TEXT";
    private static final Logger logger = LoggerFactory.getLogger(StudentSurveyResponseLabel.class);

	/**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private Long surveyResponseId;

    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.response_label
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private String responseLabel;

    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.survey_label_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private Long surveyLabelId;

    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.label_number
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private String labelNumber;
    /**
     * globalPageNum.
     */
    private int globalPageNum;
    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.survey_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private Long surveyId;

    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.student_survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private Long studentSurveyResponseId;

    /**
     * This field was generated by MyBatis Generator.
     * This field corresponds to the database column public.student_survey_response_label.student_survey_response_text
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    private String studentSurveyResponseText;
    /**
     * This is the student Survey Text given during upload.
     */
    private String givenStudentSurveyResponseText;
	/**
	 * given 
	 */
	private boolean given;
	/**
	 * optional
	 */
	private boolean optional;
	/**
	 * activeFlag
	 */
	private boolean activeFlag;
	/**
	 * label
	 */
	private String label;	
	/**
	 * responseValue
	 */
	private String responseValue;
	
	/**
	 * studentResponseId
	 */
	private Long studentResponseId;
	
	/**
	 * surveySectionName
	 */
	private String surveySectionName;
	
	
    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.survey_response_id
     *
     * @return the value of public.student_survey_response_label.survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public Long getSurveyResponseId() {
        return surveyResponseId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.survey_response_id
     *
     * @param surveyResponseId the value for public.student_survey_response_label.survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setSurveyResponseId(Long surveyResponseId) {
        this.surveyResponseId = surveyResponseId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.response_label
     *
     * @return the value of public.student_survey_response_label.response_label
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public String getResponseLabel() {
        return responseLabel;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.response_label
     *
     * @param responseLabel the value for public.student_survey_response_label.response_label
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setResponseLabel(String responseLabel) {
        this.responseLabel = responseLabel == null ? null : responseLabel.trim();
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.survey_label_id
     *
     * @return the value of public.student_survey_response_label.survey_label_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public Long getSurveyLabelId() {
        return surveyLabelId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.survey_label_id
     *
     * @param surveyLabelId the value for public.student_survey_response_label.survey_label_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setSurveyLabelId(Long surveyLabelId) {
        this.surveyLabelId = surveyLabelId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.label_number
     *
     * @return the value of public.student_survey_response_label.label_number
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public String getLabelNumber() {
        return labelNumber;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.label_number
     *
     * @param labelNumber the value for public.student_survey_response_label.label_number
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setLabelNumber(String labelNumber) {
        this.labelNumber = labelNumber == null ? null : labelNumber.trim();
    }

    public int getGlobalPageNum() {
		return globalPageNum;
	}

	public void setGlobalPageNum(int globalPageNum) {
		this.globalPageNum = globalPageNum;
	}

	/**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.survey_id
     *
     * @return the value of public.student_survey_response_label.survey_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public Long getSurveyId() {
        return surveyId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.survey_id
     *
     * @param surveyId the value for public.student_survey_response_label.survey_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setSurveyId(Long surveyId) {
        this.surveyId = surveyId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.student_survey_response_id
     *
     * @return the value of public.student_survey_response_label.student_survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public Long getStudentSurveyResponseId() {
        return studentSurveyResponseId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.student_survey_response_id
     *
     * @param studentSurveyResponseId the value for public.student_survey_response_label.student_survey_response_id
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setStudentSurveyResponseId(Long studentSurveyResponseId) {
        this.studentSurveyResponseId = studentSurveyResponseId;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method returns the value of the database column public.student_survey_response_label.student_survey_response_text
     *
     * @return the value of public.student_survey_response_label.student_survey_response_text
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public String getStudentSurveyResponseText() {
        return studentSurveyResponseText;
    }

    /**
     * This method was generated by MyBatis Generator.
     * This method sets the value of the database column public.student_survey_response_label.student_survey_response_text
     *
     * @param studentSurveyResponseText the value for public.student_survey_response_label.student_survey_response_text
     *
     * @mbggenerated Sat Apr 13 21:14:54 CDT 2013
     */
    public void setStudentSurveyResponseText(String studentSurveyResponseText) {
        this.studentSurveyResponseText = studentSurveyResponseText == null ? null : studentSurveyResponseText.trim();
    }

    /**
	 * @return the givenStudentSurveyResponseText
	 */
	public String getGivenStudentSurveyResponseText() {
		return givenStudentSurveyResponseText;
	}

	/**
	 * @param givenStudentSurveyResponseText the givenStudentSurveyResponseText to set
	 */
	public void setGivenStudentSurveyResponseText(
			String givenStudentSurveyResponseText) {
		this.givenStudentSurveyResponseText = givenStudentSurveyResponseText;
	}

	/**
	 * @return the optional
	 */
	public boolean isOptional() {
		return optional;
	}

	/**
	 * @param optional the optional to set
	 */
	public void setOptional(boolean optional) {
		this.optional = optional;
	}

	public boolean isExisting() {
    	return (getStudentSurveyResponseId() != null);
    }

	/**
	 * @return the given
	 */
	public final boolean isGiven() {
		return given;
	}

	/**
	 * @return the activeFlag
	 */
	public boolean isActiveFlag() {
		return activeFlag;
	}

	/**
	 * @param activeFlag the activeFlag to set
	 */
	public void setActiveFlag(boolean activeFlag) {
		this.activeFlag = activeFlag;
	}

	/**
	 * if set indicates, that this value was given in the upload.
	 * @param b
	 */
	
	public void setGiven(boolean b) {
		this.given = b;
	}
	
	/**
	 * @return label
	 */
	public String getLabel() {
		return label;
	}

	/**
	 * @param label
	 */
	public void setLabel(String label) {
		this.label = label;
	}

	/**
	 * @return responseValue
	 */
	public String getResponseValue() {
		return responseValue;
	}

	/**
	 * @param responseValue
	 */
	public void setResponseValue(String responseValue) {
		this.responseValue = responseValue;
	}
	
	/**
	 * @return studentResponseId
	 */
	public Long getStudentResponseId() {
		return studentResponseId;
	}

	/**
	 * @param studentResponseId
	 */
	public void setstudentResponseId(Long studentResponseId) {
		this.studentResponseId = studentResponseId;
	}
	
	/**
	 * @return surveySectionName
	 */
	public String getSurveySectionName() {
		return surveySectionName;
	}

	/**
	 * @param studentResponseId
	 */
	public void setSurveySectionName(String surveySectionName) {
		this.surveySectionName = surveySectionName;
	}
	
	/**
	 * If true the existing record needs to be removed
	 * @return
	 */
	public boolean doRemove() {
		return (isExisting() && !isGiven() );
	}
	
	/**
	 * if true then response needs to be inserted for the given student.
	 * @return
	 */
	public boolean doAdd() {
		return (!isExisting() && isGiven() );
	}
	/**
	 * INFO: if true then response needs to be updated for the given student.
	 * This is only true for text response.
	 * This means the existing and given response labels are the same
	 * but their text values are different.
	 * 
	 * @return
	 */
	public boolean doUpdate() {
		boolean doUpdate = false;
		if(isTextResponse()) {
			//INFO: Existing and given but existing is not active.
			doUpdate = isExisting()
					&& isGiven() && (!isActiveFlag() || !isSameTextResponse());
		} else {
			//INFO: Existing and given but existing is not active.
			doUpdate = isExisting() && isGiven() && !isActiveFlag();
		}
		return doUpdate;
	}


	private boolean isSameTextResponse() {
		return (getStudentSurveyResponseText() != null
				&& StringUtils.hasText(getStudentSurveyResponseText())
				&& getGivenStudentSurveyResponseText() != null
				&& StringUtils.hasText(getGivenStudentSurveyResponseText())
				&& getStudentSurveyResponseText(
						).equalsIgnoreCase(
								getGivenStudentSurveyResponseText())
						);
	}

	private boolean isTextResponse() {
		return TEXT.equalsIgnoreCase(getResponseLabel());
	}

	public boolean doNone() {
		return (!doAdd() && !doRemove());
	}
	
	/**
	 * INFO: if the given label number and response label matches this StudentSurveyResponseLabel
	 * then given is set as true.
	 * @param givenLabelResponseMap
	 */
	public void setGivenLabelResponseMap(
			Map<String, String> givenLabelResponseMap) {
		this.setGiven(givenLabelResponseMap != null
				&& givenLabelResponseMap.size() > 0 
				&& givenLabelResponseMap.containsKey(getLabelNumber())
				&& givenLabelResponseMap.get(getLabelNumber()).equalsIgnoreCase(getResponseLabel())
				);
	}

	/**
	 * INFO: if the given label number and response label matches this StudentSurveyResponseLabel
	 * then given is set as true.
	 * @param givenTextLabelResponseMap
	 */
	public void setGivenTextLabelResponseMap(
			Map<String, String> givenTextLabelResponseMap) {
		//Set given if the text question label is given in the input.
		if(!isGiven()) {
			//INFO: if given is not set it means the existing response is not a text question (or) not the same question,response pair
			if(givenTextLabelResponseMap != null
					&& givenTextLabelResponseMap.size() > 0 
					&& givenTextLabelResponseMap.containsKey(getLabelNumber())
					&& TEXT.equalsIgnoreCase(getResponseLabel())
					) {
					setGiven(true);
					//if given then set the response text.
					this.givenStudentSurveyResponseText
					= givenTextLabelResponseMap.get(getLabelNumber());			
			}			
		}
	}	
	public StudentSurveyResponse getStudentSurveyResponse() {
		StudentSurveyResponse studentSurveyResponse = new StudentSurveyResponse();
		studentSurveyResponse.setId(getStudentSurveyResponseId());
		studentSurveyResponse.setResponseText(getGivenStudentSurveyResponseText());
		studentSurveyResponse.setSurveyResponseId(getSurveyResponseId());
		return studentSurveyResponse;
	}
	public StudentSurveyResponse getStudentSurveyResponse(Long surveyId) {
		StudentSurveyResponse studentSurveyResponse = getStudentSurveyResponse();
		studentSurveyResponse.setSurveyId(surveyId);
		return studentSurveyResponse;
	}
	/* (non-Javadoc)
	 * @see java.lang.Object#toString()
	 */
	@Override
	public String toString() {
		StringBuilder builder = new StringBuilder();
		builder.append("StudentSurveyResponseLabel [");
		if (surveyResponseId != null) {
			builder.append("surveyResponseId=");
			builder.append(surveyResponseId);
			builder.append(", ");
		}
		if (responseLabel != null) {
			builder.append("responseLabel=");
			builder.append(responseLabel);
			builder.append(", ");
		}
		if (surveyLabelId != null) {
			builder.append("surveyLabelId=");
			builder.append(surveyLabelId);
			builder.append(", ");
		}
		if (labelNumber != null) {
			builder.append("labelNumber=");
			builder.append(labelNumber);
			builder.append(", ");
		}
		if (surveyId != null) {
			builder.append("surveyId=");
			builder.append(surveyId);
			builder.append(", ");
		}
		if (studentSurveyResponseId != null) {
			builder.append("studentSurveyResponseId=");
			builder.append(studentSurveyResponseId);
			builder.append(", ");
		}
		if (studentSurveyResponseText != null) {
			builder.append("studentSurveyResponseText=");
			builder.append(studentSurveyResponseText);
			builder.append(", ");
		}
		if (label != null) {
			builder.append("label=");
			builder.append(label);
			builder.append(", ");
		}
		if (responseValue != null) {
			builder.append("responseValue=");
			builder.append(responseValue);
			builder.append(", ");
		}
		if(surveySectionName != null){
			builder.append("surveySectionName=");
			builder.append(surveySectionName);
			builder.append(", ");
		}
		builder.append("given=");
		builder.append(given);
		builder.append("]");
		return builder.toString();
	}

	public String getSurvey_section_name() {
		return surveySectionName;
	}

	public void setSurvey_section_name(String survey_section_name) {
		this.surveySectionName = survey_section_name;
	}
	
	private String surveyResponseValue;
	
	public String getSurveyResponseValue() {
		return surveyResponseValue;
	}
	
	public void setSurveyResponseValue(String value) {
		this.surveyResponseValue = value;
	}

}