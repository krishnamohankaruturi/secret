
-- find users in multiple groups.It should be 0.

select count(1) from userorganizationsgroups where 
groupid in (
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
) and userorganizationid in (
Select userorganizationid from userorganizationsgroups group by userorganizationid having count(1) > 1);

--266 expected count.

select count(1) from userorganizationsgroups where 
groupid in (
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
);

--update for userorganizations groups. expected 266.

update userorganizationsgroups set groupid=9572
where groupid in (
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
);

--expected count 7020 rows.

select count(distinct(id)) from groupauthorities where groupid in
(
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
);

--Expected to delete 7020 in prod, rollback otherwise.For QA no verification on count is
--needed.

delete from groupauthorities where groupid in
(
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
);

--Expected count 200

select count(distinct(id)) from groups
 where id in (
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
);

--Expected 200 in prod, rollback otherwise.For QA no verification on count is
--needed.

delete from groups
 where id in (
'5492', '5513', '5553', '5504', '5567', '5518', '9501', '5564',
'5563', '9650', '5541', '9663', '9662', '5554', '5473', '5526', '5495', 
'9660', '9648', '5524', '9503', '9671', '9565', '5521', '5556', '9563',
'5494', '9672', '5579', '5577', '5482', '9558', '5194', '9504', '9588',
'9600', '5511', '9638', '9643', '9647', '5491', '5539', '5537', '5191',
'9599', '9583', '9601', '9582', '9586', '5566', '5479', '9673', '5546', '9661',
'9667', '5500', '5499', '5558', '9594', '5561', '5560', '9589', '9677', '9649', 
'7119', '7125', '5198', '7126', '9556', '5200', '9655', '9551', '9557', '7123',
'9553', '9659', '5201', '5472', '5202', '5195', '5185', '9630', '9641', '9597',
'9598', '5186', '9573', '5187', '9642', '9604', '9633', '9639', '9634', '5188', 
'9631', '9632', '5192', '9644', '9640', '9636', '9602', '9646', '5193', '9645',
'5190', '9635', '9555', '9678', '9670', '7124', '7120', '9666', '5470', '9552',
'5471', '9665', '9561', '9669', '9657', '9658', '9664', '9577', '9580', '9676', 
'5512', '5478', '9584', '9585', '9560', '9559', '5476', '9581', '5474', '9592',
'5496', '5493', '9591', '5488', '5487', '5486', '9590', '5484', '5483', '5510', 
'5509', '5508', '5507', '5506', '9593', '5505', '5503', '5502', '5498', '5497',
'5516', '5578', '5576', '5575', '5574', '5515', '5514', '5536', '5535', '5534', 
'5533', '5532', '9595', '9510', '5531', '5530', '9587', '5527', '9654', '5525',
'5523', '5557', '5555', '9509', '9548', '5552', '5551', '5550', '5549', '5548',
'9546', '9505', '5581', '5580', '5545', '5544', '5543', '5572', '5540', '5538',
'5571', '5570', '5569', '5568', '9656', '5562'
 );
