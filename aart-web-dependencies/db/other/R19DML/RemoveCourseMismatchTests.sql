DO $$DECLARE

STUDENTTRACKERBAND_ROW RECORD;
STUDENTTRACKER_ROW RECORD;
STUDGRADE VARCHAR;
ENROLLMENT_ROW RECORD;
ROSTER_ROW RECORD;
ORGPOOLTYPE VARCHAR;
COUNT BIGINT;
STBAND_COUNT BIGINT;
TESTCOLLECTION_ROW RECORD;
TESTGRADE VARCHAR;
TESTSPECFLAG VARCHAR;
COURSEMISSPOSITION BIGINT;
STUDINFO_ROW RECORD;
TESTSESSIONIDDATA BIGINT;
GRADETESTSPEC_ROW RECORD;
STBANDTESTSPEC_ROW RECORD;
STBANDGRADEID BIGINT;
STUDGRADEID BIGINT;
STDATA BIGINT[][];
STBANDDATA BIGINT[];
STUDENTTRACKERBAND_ROW1 RECORD;
ROSTERCOUNT BIGINT;

BEGIN

COUNT:=0;
STBAND_COUNT:=0;
ROSTERCOUNT:=0;

STDATA:=ARRAY[[487973,440],
[734318,440],
[810753,440],
[815561,440],
[853474,440],
[853476,440],
[853477,440],
[853478,440],
[853479,440],
[853480,440],
[854895,440],
[854896,440],
[854897,440],
[854898,440],
[854899,440],
[854900,440],
[855406,440],
[855407,440],
[855408,440],
[855409,440],
[855412,440],
[855413,440],
[855414,440],
[855419,440],
[855420,440],
[855423,440],
[855424,440],
[855425,440],
[855427,440],
[855898,440],
[855900,440],
[855940,440],
[856267,440],
[856347,3],
[856342,440],
[856343,440],
[856344,440],
[856345,440],
[856346,440],
[856348,440],
[856349,440],
[856350,440],
[856353,440],
[856527,440],
[856697,440],
[856698,440],
[856699,440],
[856701,440],
[856699,3],
[856722,440],
[856811,440],
[856825,440],
[856982,440],
[856985,440],
[856996,440],
[856998,440],
[857052,440],
[857123,440],
[857125,440],
[857127,440],
[857222,440],
[857224,440],
[857225,440],
[857227,440],
[857229,440],
[857305,440],
[857306,440],
[858673,3],
[859007,440],
[859154,440],
[859155,440],
[859156,440],
[859157,440],
[859356,440],
[859542,440],
[859544,440],
[859550,440],
[859551,440],
[859542,3],
[859544,3],
[859550,3],
[859551,3],
[860094,440],
[860095,440],
[860096,440],
[860097,440],
[860098,440],
[860099,440],
[860180,3],
[860204,3],
[860204,440],
[860205,440],
[860208,440],
[860234,440],
[860256,3],
[860256,440],
[860272,440],
[860294,3],
[860289,440],
[860294,440],
[860309,3],
[860307,440],
[860309,440],
[860582,440],
[860894,440],
[860895,440],
[860912,440],
[861045,440],
[861047,440],
[861050,440],
[861051,440],
[861051,3],
[861052,440],
[861053,440],
[861208,440],
[861286,440],
[861287,440],
[861298,440],
[862040,440],
[862101,440],
[862116,440],
[862006,3],
[862560,440],
[863678,440],
[863678,3],
[864108,440],
[864109,440],
[864110,440],
[864142,440],
[864146,440],
[864147,440],
[864110,3],
[864479,440],
[864552,440],
[864582,440],
[864945,440],
[865148,440],
[865150,440],
[865153,440],
[865161,440],
[865162,440],
[865163,440],
[865165,440],
[865167,440],
[865522,440],
[865164,3],
[866140,440],
[866141,440],
[877803,440],
[880359,440],
[880821,440],
[881226,440],
[891353,440],
[891365,440],
[899981,440],
[899982,440],
[899983,440],
[899985,440],
[909114,440],
[909115,440],
[909120,440],
[909131,440],
[909137,440],
[909152,440],
[912160,440],
[912167,440],
[912970,440],
[913071,440],
[913074,440],
[923951,440],
[924005,440],
[927222,440],
[927223,440],
[927229,440],
[928516,440],
[912970,3],
[913069,3],
[913070,3],
[929119,440],
[929120,440],
[923951,3],
[928510,3],
[928511,3],
[928513,3],
[928514,3],
[929200,440],
[929201,440],
[929331,440],
[929814,440],
[929859,440],
[929886,440],
[929888,440],
[946832,440],
[946833,440],
[969795,440],
[970514,440],
[970515,440],
[988427,440],
[988427,3],
[859240,440],
[863029,3],
[926976,440],
[928517,440],
[928518,440],
[928849,440],
[929121,440],
[929122,440],
[928850,3],
[969789,440],
[969790,440],
[1021590,440],
[1021591,440],
[864754,440],
[872967,440],
[928515,3],
[1031783,440],
[1031782,440],
[861057,440],
[891369,440],
[891372,440],
[891373,440],
[891374,440],
[861058,440],
[855402,440],
[855396,440],
[855403,440],
[855404,440],
[928837,440],
[928838,440],
[928839,440],
[928840,440],
[928841,440],
[928842,440],
[928843,440],
[928844,440],
[928845,440],
[928846,440],
[855395,440],
[928847,440],
[855398,440],
[864861,440],
[861075,440],
[861076,440],
[861077,440],
[861078,440],
[861080,440],
[885389,3],
[969468,440],
[855397,440],
[859662,440],
[862303,3],
[1039420,440],
[855391,440],
[855392,440],
[855400,440],
[855401,440],
[859538,440],
[861079,440],
[1039421,440],
[1039422,440],
[966674,440],
[966675,440],
[969464,440],
[969465,440],
[969466,440],
[969467,440],
[928850,440],
[860086,440],
[860087,440],
[1038709,440],
[1038705,3],
[1038714,440],
[1033790,440],
[1038803,440],
[865570,440],
[865574,440],
[865582,440],
[865596,440],
[866991,440],
[1038716,440],
[1038718,440],
[1038730,440],
[1038734,440],
[1038734,3],
[1038774,440],
[1038774,3],
[926974,440],
[1038712,440],
[1038706,440],
[1033802,440],
[1033818,440],
[1038713,440],
[1038722,440],
[1038791,3],
[1038786,440],
[1038790,440],
[1038791,440],
[1033884,440],
[865004,440],
[856351,440],
[857906,440],
[857906,3],
[859466,440],
[969644,440],
[969644,3],
[1042717,440],
[1045809,440],
[853711,440],
[856528,440],
[856529,440],
[886018,440],
[864811,440],
[858998,440],
[861352,440],
[856530,440],
[909082,3],
[909082,440],
[1039579,440],
[856347,440],
[855417,440],
[855422,440],
[855422,3],
[855418,440],
[855421,440],
[855426,440],
[859469,3],
[1042716,440],
[859480,440],
[864987,440],
[929349,3],
[950987,3],
[1039595,3],
[860171,440],
[860183,440],
[885975,3],
[860101,440],
[861900,440],
[862067,440],
[863730,440],
[864575,440],
[864791,440],
[885921,440],
[885923,440],
[885956,440],
[885975,440],
[971373,440],
[971374,440],
[1033804,440],
[1039595,440],
[1068304,440],
[1068305,440],
[1068306,440],
[1068307,440],
[909094,440],
[1033832,440],
[1033889,440],
[1068308,440],
[971375,440],
[1054706,440],
[1068310,440],
[1054705,440],
[969794,440],
[877697,3],
[877697,440],
[856558,440],
[856559,440],
[909072,440],
[861059,440],
[909101,440],
[1039582,440],
[882365,440],
[1057997,3],
[1057996,440],
[882366,440],
[855410,3],
[855410,440],
[882394,440],
[882367,440],
[882369,440],
[928858,440],
[929153,440],
[929184,440],
[1039575,440],
[864638,440],
[969781,440],
[864675,440],
[969782,440],
[929185,440],
[969779,440],
[969780,440],
[861056,440],
[856307,440],
[861067,440],
[929130,440],
[969926,440],
[969927,3],
[969927,440],
[1075998,440],
[1076000,440],
[929152,440],
[929157,440],
[1033834,440],
[1039578,440],
[885940,440],
[969928,440],
[885961,440],
[969930,440],
[861628,440],
[929149,3],
[929150,440],
[929150,3],
[1081925,440],
[859867,3],
[859867,440],
[860103,440],
[860106,440],
[950621,3],
[1049927,440],
[865222,440],
[929126,440],
[930812,440],
[860224,3],
[860224,440],
[860368,440],
[860264,3],
[860230,440],
[860264,440],
[860265,440],
[860268,440],
[1038775,440],
[1093009,440],
[915963,440],
[1039565,440],
[1054797,440],
[861665,440],
[861681,440],
[861692,440],
[861696,440],
[861693,440],
[861704,440],
[861659,3],
[971185,440],
[856495,440],
[856400,440],
[1033821,440],
[1038737,3],
[1038737,440],
[1099490,3],
[1099490,440],
[1039581,440],
[1088634,440],
[886021,440],
[900148,440],
[859539,440],
[859540,440],
[859541,440],
[859539,3],
[859540,3],
[859541,3],
[859554,440],
[859554,3],
[867816,3],
[915964,440],
[861627,440],
[1039568,440],
[1039573,440],
[1101244,3],
[1101294,440],
[1039564,440],
[1039567,440],
[1039571,440],
[1039574,440],
[1039577,440],
[1039577,3],
[1101153,440],
[1039561,440],
[1039562,3],
[1097569,440],
[862179,440],
[861664,440],
[861677,440],
[861677,3],
[1039580,440],
[908209,440],
[1105049,440],
[862066,440],
[1105050,440],
[1105051,440],
[1029982,3],
[1029982,440],
[1105053,440],
[1093150,440],
[1093185,440],
[861698,440],
[861700,440],
[1108698,440],
[859556,3],
[859558,3],
[859556,440],
[859558,440],
[859543,440],
[859543,3],
[855399,3],
[859573,3],
[859614,3],
[859634,3],
[859665,3],
[855390,440],
[855394,440],
[855399,440],
[859573,440],
[859614,440],
[859634,440],
[859665,440],
[1081942,440],
[912164,440],
[929162,3],
[1102503,440],
[929174,440],
[1072750,3],
[1072764,3],
[1072783,3],
[1072787,3],
[1072796,3],
[1072831,3],
[1072935,3],
[1072952,3],
[1072983,3],
[1073017,3],
[1073024,3],
[1073043,3],
[1073107,3],
[1073124,3],
[1073156,3],
[1073248,3],
[1073296,3],
[1073418,3],
[1073432,3],
[1073444,3],
[1073559,3],
[1073569,3],
[1073581,3],
[1073582,3],
[1073591,3],
[1073657,3],
[1073667,3],
[1073723,3],
[1073743,3],
[1073751,3],
[1073825,3],
[1073828,3],
[1073846,3],
[1073913,3],
[1073920,3],
[1073931,3],
[1073961,3],
[1073967,3],
[1073968,3],
[1074023,3],
[1074044,3],
[1074083,3],
[1074123,3],
[1074147,3],
[1074188,3],
[1074197,3],
[1074289,3],
[1074371,3],
[1074394,3],
[1074524,3],
[1074535,3],
[1074671,3],
[1074693,3],
[1074755,3],
[1074782,3],
[1074876,3],
[1074881,3],
[1074951,3],
[1074962,3],
[1074987,3],
[1075004,3],
[1075065,3],
[1075081,3],
[1075085,3],
[1075094,3],
[1075103,3],
[1075145,3],
[1075165,3],
[1075307,3],
[1075334,3],
[1075418,3],
[1075534,3],
[1075575,3],
[1075648,3],
[1075684,3],
[1075696,3],
[1075711,3],
[1075731,3],
[1075761,3],
[1075763,3],
[1075819,3],
[1075837,3],
[1075871,3],
[1075881,3],
[1075922,3],
[1075942,3],
[1075945,3],
[1075952,3],
[1075969,3],
[1075977,3],
[1076101,3],
[1076219,3],
[1076243,3],
[1076260,3],
[1076285,3],
[1076300,3],
[1100889,3],
[1033801,440],
[1033808,440],
[1033822,440],
[1033830,440],
[1033838,440],
[1033848,440],
[1033831,440],
[1033844,440],
[1033846,440],
[1051122,440],
[1033888,440],
[1033835,440],
[1033868,440],
[950620,440],
[950621,440],
[1074841,3],
[1110926,440],
[1072778,3],
[1073384,3],
[859863,3],
[1074240,3],
[1074307,3],
[1074334,3],
[1074505,3],
[1074543,3],
[1074723,3],
[1074846,3],
[1075028,3],
[1075196,3],
[1075591,3],
[859863,440],
[860102,440],
[860113,440],
[1076093,3],
[864437,440],
[1076313,3],
[1108889,3],
[865223,440],
[929172,440],
[1033815,440],
[1033825,440],
[1033833,440],
[1033839,440],
[1033861,440],
[1033865,440],
[1033877,440],
[1039553,440],
[1039554,440],
[1039555,440],
[1097294,440],
[1108889,440],
[856566,440],
[929857,440],
[877096,440],
[877098,440],
[877113,440],
[1073236,3],
[1074256,3],
[1075926,3],
[1074260,3],
[1075687,3],
[1109026,440],
[1038741,440],
[1074112,3],
[1079930,3],
[1073563,3],
[859851,3],
[859851,440],
[865591,440],
[865575,440],
[929819,440],
[929819,3],
[865598,440],
[1074490,3],
[929822,440],
[1111278,440],
[1073645,3],
[1075062,3],
[929860,440],
[1075532,3],
[877114,440],
[929858,440],
[929861,440],
[877123,440],
[1068108,440],
[929855,440],
[1072866,3],
[1074753,3],
[1074770,3],
[1075299,3],
[1075886,3],
[856086,440],
[1076348,3],
[929854,440],
[1072989,3],
[886019,440],
[886022,440],
[1074278,3],
[1074440,3],
[929164,440],
[929166,440],
[929167,440],
[929170,440],
[1072750,440],
[1072764,440],
[1072778,440],
[1072783,440],
[1072787,440],
[1072796,440],
[1072831,440],
[1072866,440],
[1072935,440],
[1072952,440],
[1072983,440],
[1072989,440],
[1073017,440],
[1073024,440],
[1073043,440],
[1073107,440],
[1073124,440],
[1073156,440],
[1073236,440],
[1073248,440],
[1073296,440],
[1073384,440],
[1073418,440],
[1073432,440],
[1073444,440],
[1073559,440],
[1073563,440],
[1073569,440],
[1073581,440],
[1073582,440],
[1073591,440],
[1073645,440],
[1073657,440],
[1073667,440],
[1073723,440],
[1073743,440],
[1073751,440],
[1073825,440],
[1073828,440],
[1073846,440],
[1073913,440],
[1073920,440],
[1073931,440],
[1076293,3],
[1073961,440],
[1073967,440],
[1073968,440],
[1074023,440],
[1074044,440],
[1074083,440],
[1074112,440],
[1074123,440],
[1074147,440],
[1074188,440],
[1074197,440],
[1074240,440],
[1074256,440],
[1074260,440],
[1074278,440],
[1074289,440],
[1074307,440],
[1074334,440],
[1074371,440],
[1074394,440],
[1074440,440],
[1074490,440],
[1074505,440],
[1074524,440],
[1074535,440],
[1074543,440],
[1074671,440],
[1074693,440],
[1074723,440],
[1074753,440],
[1074755,440],
[1074770,440],
[1074782,440],
[1074841,440],
[1074846,440],
[1074876,440],
[1074881,440],
[1074951,440],
[1074962,440],
[1074987,440],
[1075004,440],
[1075028,440],
[1075062,440],
[1075065,440],
[1075081,440],
[1075085,440],
[1075094,440],
[1075103,440],
[1075145,440],
[1075165,440],
[1075196,440],
[1075299,440],
[1075307,440],
[1075334,440],
[1075418,440],
[1075532,440],
[1075534,440],
[1075575,440],
[1075591,440],
[1075648,440],
[1075684,440],
[1075687,440],
[1075696,440],
[1075711,440],
[1075731,440],
[1075761,440],
[1075763,440],
[1075819,440],
[1075837,440],
[1075871,440],
[1075881,440],
[1075886,440],
[1075922,440],
[1075926,440],
[1075942,440],
[1075945,440],
[1075952,440],
[1075969,440],
[1075977,440],
[1076093,440],
[1076101,440],
[1076219,440],
[1076243,440],
[1076260,440],
[1076285,440],
[1076293,440],
[1076300,440],
[1076313,440],
[1076348,440],
[1100889,440],
[886022,3],
[929116,440],
[1073932,440],
[1073932,3],
[929863,440],
[1075457,3],
[1076185,3],
[1075457,440],
[1076185,440],
[929862,440],
[866988,440],
[1089468,3],
[1089468,440],
[1074110,3],
[1074968,3],
[1075355,3],
[1074110,440],
[1074968,440],
[1075355,440],
[1093916,440],
[1074145,440],
[1074145,3],
[1076249,440],
[1076249,3],
[1073393,3],
[1073393,440],
[1074510,3],
[1074510,440],
[1073391,440],
[1110965,3],
[1073391,3],
[1110965,440],
[1110966,440],
[1110967,440],
[1093428,3],
[1093915,440],
[1075257,3],
[1093909,440],
[1093914,440],
[1075257,440],
[859549,440],
[1074331,440],
[1073184,3],
[1074331,3],
[1073184,440],
[1093539,440],
[1074036,440],
[1072832,440],
[862850,440],
[1072832,3],
[1074036,3],
[1042844,3],
[1042844,440],
[1073643,3],
[1073643,440],
[1113441,440],
[1074933,440],
[1118352,440],
[1074933,3],
[1097333,440],
[1118355,440],
[1072865,3],
[1072865,440],
[1074121,440],
[1074121,3],
[1118354,440],
[1073987,3],
[1075553,3],
[1073987,440],
[1075553,440],
[1074427,440],
[1074427,3],
[1075704,440],
[1075704,3],
[1083857,440],
[1083861,440],
[1083857,3],
[1083861,3],
[1075732,440],
[1075732,3],
[1073847,440],
[1074704,440],
[1073847,3],
[1074336,3],
[1074704,3],
[1075663,3],
[1074336,440],
[1074923,440],
[1074956,440],
[1075183,440],
[1075468,440],
[1075555,440],
[1075663,440],
[1121987,440],
[1074923,3],
[1074956,3],
[1075183,3],
[1075468,3],
[1075555,3],
[1074016,3],
[1074016,440],
[899433,440],
[1109082,440],
[1123930,440],
[1123933,440],
[899994,440],
[1072727,440],
[859574,440],
[1076270,440],
[1109024,440],
[1072727,3],
[1076270,3],
[1072808,3],
[1075677,3],
[1076017,3],
[1072808,440],
[1073392,440],
[1074210,440],
[1074424,440],
[1073392,3],
[1074210,3],
[1074424,3],
[1075022,3],
[1075022,440],
[1075677,440],
[1076017,440],
[1097289,3],
[1097289,440],
[1075329,3],
[1075950,3],
[899995,440],
[899996,440],
[1075329,440],
[1075950,440],
[1109067,440],
[1109080,440],
[1109062,440],
[1073057,440],
[1073057,3],
[1073188,440],
[1073188,3],
[1075032,440],
[1075032,3],
[1075920,440],
[1075920,3],
[1073517,440],
[1074437,440],
[1073517,3],
[1074437,3],
[1075460,440],
[1076150,440],
[861372,440],
[1075460,3],
[1076150,3],
[861635,440],
[861637,440],
[1083647,440],
[1083647,3],
[861645,440],
[1073520,440],
[1073520,3],
[1075253,440],
[861633,440],
[861661,440],
[1072966,440],
[1074487,440],
[1072966,3],
[1074487,3],
[1075253,3],
[899998,440],
[1126455,440],
[1126455,3],
[1073379,3],
[1073379,440],
[877658,440],
[1130025,440],
[1130026,440],
[868659,440],
[1075394,3],
[1075394,440],
[1073257,3],
[1073257,440],
[1074074,440],
[1074615,440],
[1074074,3],
[1074615,3],
[1074991,3],
[1074991,440],
[1075999,3],
[1075999,440],
[1076001,3],
[1076001,440],
[1039570,440],
[1039576,3],
[1039576,440],
[1101156,440],
[1126813,3],
[1101160,440],
[1126813,440],
[899999,440],
[929183,440],
[1097297,440],
[1103356,440],
[1103357,440],
[864460,440],
[864487,440],
[1073789,440],
[1073789,3],
[1074403,440],
[1074403,3],
[1083855,440],
[1083855,3],
[1083856,440],
[1083856,3],
[1029983,440],
[1083858,3],
[1083859,3],
[1124800,440],
[1083858,440],
[1083859,440],
[1074159,440],
[1074159,3],
[864539,440],
[946835,440],
[1073955,440],
[1073955,3],
[855941,440],
[1075066,440],
[1075066,3],
[1131026,3],
[1083860,3],
[1083860,440],
[1131023,440],
[1076132,3],
[1076132,440],
[929108,440],
[1033855,440],
[1075679,3],
[1075679,440],
[1074158,3],
[1075033,3],
[1074158,440],
[1075033,440],
[1073484,440],
[1074330,3],
[1073960,440],
[1074330,440],
[1075385,3],
[1075385,440],
[1133100,3],
[1075933,440],
[1076135,440],
[1075933,3],
[900000,440],
[900000,3],
[1074329,440],
[929814,3],
[1074329,3],
[900001,440],
[1122873,440],
[1074227,440],
[1122879,3],
[1122879,440],
[1091988,440],
[1092003,3],
[1092048,440],
[929171,440],
[1033867,440],
[1033872,440],
[1038738,440],
[1092052,440],
[867984,3],
[867984,440],
[867987,440],
[867990,440],
[867987,3],
[1124098,440],
[1075832,3],
[1075832,440],
[1076170,440],
[1076170,3],
[864480,440],
[859574,3],
[1075222,3],
[1075222,440],
[1132153,440],
[1076350,440],
[1076350,3],
[854238,3],
[1075063,3],
[1075602,3],
[1075063,440],
[1075602,440],
[867994,3],
[867997,3],
[867994,440],
[867997,440],
[868001,440],
[1100854,440],
[1100855,440],
[1074839,3],
[1074839,440],
[865887,440],
[1126991,3],
[1092047,440],
[1126991,440],
[1073525,3],
[1073525,440],
[1135072,440],
[1135076,440],
[1135072,3],
[1135076,3],
[1088451,440],
[1074646,440],
[1074646,3],
[867998,440],
[1074096,3],
[857126,440],
[1088639,440],
[1088639,3],
[853636,440],
[1074767,3],
[1124700,3],
[1074767,440],
[1124700,440],
[1073088,3],
[1073088,440],
[861048,440],
[861049,440],
[1091978,440],
[1091978,3],
[899993,440],
[1072759,3],
[1075705,3],
[1072759,440],
[1075705,440],
[1074230,3],
[1074230,440],
[1135540,440],
[1073505,3],
[1074774,3],
[1075287,3],
[1075563,3],
[1073505,440],
[858171,440],
[1074774,440],
[1075287,440],
[1075563,440],
[1105052,440],
[858169,440],
[858172,440],
[858170,3],
[1076120,440],
[1076120,3],
[858168,440],
[858170,440],
[858168,3],
[1039301,3],
[1039301,440],
[856088,440],
[856089,440],
[856515,440],
[861046,440],
[1073233,440],
[1073455,440],
[864559,440],
[1073233,3],
[1073455,3],
[877691,440],
[877696,440],
[877704,440],
[1074663,440],
[1074745,440],
[885840,440],
[909975,440],
[1074663,3],
[1074745,3],
[1029981,440],
[1033787,440],
[1033807,440],
[1033820,440],
[1033827,440],
[1033843,440],
[1033858,440],
[1033869,440],
[1038725,440],
[1038726,440],
[1110979,440],
[1126664,440],
[1138775,440],
[1139985,440],
[856085,3],
[856515,3],
[861635,3],
[861637,3],
[861639,3],
[861645,3],
[861650,3],
[861661,3],
[877689,3],
[877691,3],
[1033885,3],
[1038726,3],
[1092405,3],
[1073745,440],
[1073745,3],
[1074041,440],
[1074178,440],
[1074041,3],
[1074315,440],
[1074178,3],
[1074411,440],
[1074315,3],
[1074411,3],
[1074941,440],
[1074941,3],
[1075045,440],
[1075045,3],
[1075387,440],
[1075387,3],
[1075516,440],
[1075516,3],
[1075678,440],
[1075678,3],
[1075695,440],
[1075695,3],
[1075720,440],
[1075720,3],
[1075752,3],
[1075752,440],
[853787,440],
[1074945,440],
[1075675,440],
[853787,3],
[1074945,3],
[1075675,3],
[853790,3],
[1072789,3],
[1072818,3],
[1073055,3],
[1073261,3],
[1074132,3],
[1074965,3],
[1075218,3],
[1075277,3],
[1075738,3],
[1076179,3],
[853790,440],
[1072789,440],
[1072818,440],
[1073055,440],
[1073261,440],
[1074132,440],
[1074965,440],
[1075218,440],
[1075277,440],
[1075738,440],
[1075993,440],
[1076179,440],
[1073694,3],
[1073811,3],
[1074076,3],
[862192,3],
[1074843,3],
[1075349,3],
[1073694,440],
[1073811,440],
[1074076,440],
[862184,440],
[862192,440],
[1074843,440],
[1075349,440],
[1075547,440],
[1075960,440],
[1075547,3],
[1075960,3],
[1076014,440],
[1076014,3],
[1074497,440],
[1074497,3],
[1072781,440],
[1074568,440],
[1072781,3],
[1074568,3],
[1072864,440],
[1073271,440],
[1073368,440],
[1073605,440],
[1075445,440],
[1072864,3],
[1073271,3],
[1073368,3],
[1073605,3],
[1075445,3],
[1073364,440],
[1075603,440],
[1073364,3],
[1088537,440],
[1075603,3],
[1088537,3],
[1072791,440],
[1072791,3],
[1074931,3],
[1074931,440],
[1074224,440],
[1074506,440],
[1074224,3],
[1074506,3],
[1072771,440],
[1072771,3],
[1074114,440],
[1074114,3],
[1073307,3],
[1073765,3],
[1073307,440],
[1074390,3],
[1073765,440],
[1074390,440],
[1075755,3],
[1075755,440],
[1074018,3],
[1075544,3],
[1075989,3],
[1074018,440],
[1074668,440],
[1075544,440],
[1075989,440],
[1074668,3],
[1074153,440],
[1074459,440],
[1075353,440],
[1074153,3],
[1074459,3],
[1075353,3],
[1073093,440],
[1073093,3],
[1073538,440],
[1075053,440],
[1073538,3],
[1075053,3],
[1073649,440],
[1073649,3],
[1074456,440],
[1075864,440],
[1074456,3],
[1075864,3],
[1072886,440],
[1072886,3],
[1075789,440],
[1075789,3],
[1076340,440],
[1076340,3],
[1073726,3],
[1074463,3],
[1074585,3],
[1073726,440],
[1075244,3],
[1074463,440],
[1074585,440],
[1075244,440],
[1073100,440],
[1074682,440],
[1075495,440],
[1073100,3],
[1074682,3],
[1075495,3],
[1073129,3],
[1075600,3],
[1073129,440],
[1075600,440],
[1073488,3],
[1073488,440],
[1074594,3],
[1074594,440],
[1075861,440],
[1075861,3],
[1074410,440],
[1074410,3],
[856809,440],
[856810,440],
[1074921,440],
[856352,440],
[856354,440],
[858603,440],
[1074921,3],
[865992,440],
[865993,440],
[1039919,3],
[1039919,440],
[1072930,440],
[1073728,440],
[1075754,440],
[1072930,3],
[1073728,3],
[1075754,3],
[861641,440],
[1138809,440],
[1138809,3],
[864553,440],
[864555,440],
[1138808,440],
[1073513,3],
[1074116,3],
[1073513,440],
[1074116,440],
[931347,440],
[1138812,440],
[1138815,440],
[1073570,3],
[1073570,440],
[861638,440],
[1073986,440],
[1075412,440],
[861679,440],
[1073986,3],
[891371,440],
[1075412,3],
[1138777,440],
[1073700,440],
[1073700,3],
[861648,440],
[1075788,440],
[1075788,3],
[1073838,440],
[1076100,440],
[1073838,3],
[1129744,440],
[1076100,3],
[1129744,3],
[1079930,440],
[1093927,440],
[1093928,440],
[858606,440],
[1141145,440],
[1075082,440],
[1075011,440],
[1075011,3],
[1075946,440],
[1075946,3],
[1147419,440],
[859241,440],
[859242,440],
[1147527,3],
[1147527,440],
[1115765,440],
[1115774,440],
[1072974,3],
[1072974,440],
[1110359,440],
[1111253,440],
[1111253,3],
[1147532,440],
[1073449,440],
[1074386,440],
[1073449,3],
[863143,440],
[863144,440],
[864455,440],
[864458,440],
[1074386,3],
[1076206,3],
[1076206,440],
[1074779,440],
[1074779,3],
[1073807,3],
[1073807,440],
[1073263,440],
[1073263,3],
[1076250,440],
[1076250,3],
[1147425,440],
[1072762,3],
[1075697,3],
[1072762,440],
[862295,440],
[1075697,440],
[930840,440],
[1075625,3],
[1075625,440],
[1074015,440],
[1076311,440],
[1074015,3],
[1076311,3],
[886020,440],
[1138953,440],
[861674,440],
[861618,440],
[1074306,3],
[1074306,440],
[1074597,440],
[1074597,3],
[1076264,3],
[1076264,440],
[857901,440],
[1074523,3],
[857901,3],
[1074523,440],
[1075987,440],
[1073471,440],
[1074258,440],
[1075464,440],
[988771,440],
[1074248,440],
[1076356,440],
[1134750,440],
[1075290,440],
[1088383,440],
[1072807,440],
[1072827,440],
[1074688,440],
[1075217,440],
[1074940,440],
[1075551,440],
[1105083,440],
[1072836,440],
[1073035,440],
[1074642,440],
[1075868,440],
[1073776,440],
[1075651,440],
[1075817,440],
[970493,440],
[1073023,440],
[1073788,440],
[1076009,440],
[1076338,440],
[860104,440],
[860107,440],
[860110,440],
[862983,440],
[860109,440],
[860111,440],
[860112,440],
[926973,440],
[860107,3],
[862989,440],
[1073083,440],
[1073747,440],
[1074141,440],
[1075008,440],
[1075332,440],
[1075654,440],
[988769,440],
[988765,3],
[1075921,440],
[1075971,440],
[1096444,440],
[1147528,440],
[1072807,3],
[1072827,3],
[1072836,3],
[1073023,3],
[1073035,3],
[1073083,3],
[1073471,3],
[1073747,3],
[1073776,3],
[1073788,3],
[1074141,3],
[1074248,3],
[1074258,3],
[1074642,3],
[1074688,3],
[1074940,3],
[1075008,3],
[1075217,3],
[1075290,3],
[1075332,3],
[1075464,3],
[1075551,3],
[1075651,3],
[1075654,3],
[1075817,3],
[1075868,3],
[1075921,3],
[1075971,3],
[1075987,3],
[1076009,3],
[1076338,3],
[1076356,3],
[1147528,3],
[1073219,3],
[1073724,3],
[1073219,440],
[1073724,440],
[1137744,440],
[1073729,440],
[1073826,440],
[1074344,440],
[1074382,440],
[1076115,440],
[1076194,440],
[1149047,440],
[862988,440],
[1073729,3],
[1073826,3],
[1074344,3],
[1074382,3],
[1076115,3],
[1076194,3],
[988770,440],
[1149047,3],
[1031784,440],
[1073479,3],
[1073479,440],
[929211,440],
[1033797,440],
[1033806,440],
[1033812,440],
[1033814,440],
[1033857,440],
[1033859,440],
[1149103,440],
[1073327,440],
[1075013,440],
[1073327,3],
[1075013,3],
[1149103,3],
[1134492,440],
[1074967,3],
[1076280,3],
[1074967,440],
[1076280,440],
[1073417,440],
[1073417,3],
[1073622,440],
[1074035,440],
[1074376,440],
[1073622,3],
[1074035,3],
[1134259,440],
[1134489,440],
[1074376,3],
[1134489,3],
[1073402,440],
[1073402,3],
[1075872,3],
[1075872,440],
[1148634,440],
[1149456,440],
[1149647,440],
[1074992,3],
[1075621,3],
[1075855,3],
[1074992,440],
[1075621,440],
[1075855,440],
[1138840,3],
[1033794,440],
[1139092,440],
[1073413,440],
[1073413,3],
[1033824,440],
[1033847,440],
[1033836,440],
[1033874,440],
[1033882,440],
[1124421,440],
[1033879,3],
[1073405,3],
[1073405,440],
[860100,440],
[863760,440],
[863762,440],
[863797,440],
[863799,440],
[1132968,440],
[1073282,3],
[1073282,440],
[1132971,440],
[1139091,440],
[873141,440],
[873142,440],
[873143,440],
[873146,440],
[873147,440],
[873141,3],
[873142,3],
[873143,3],
[873146,3],
[873147,3],
[1148685,440],
[873144,3],
[873145,3],
[1075450,3],
[861631,440],
[873144,440],
[873145,440],
[1075450,440],
[865073,440],
[929175,440],
[1074685,440],
[1074685,3],
[929176,440],
[1149789,440],
[1076204,3],
[1076204,440],
[856702,440],
[856703,440],
[882690,440],
[1149792,440],
[1149795,440],
[970497,440],
[1149802,440],
[855774,440],
[855776,440],
[855774,3],
[929177,440],
[929178,440],
[929179,440],
[929178,3],
[929190,440],
[932552,440],
[1147529,440],
[866139,440],
[1073855,3],
[1073855,440],
[1073982,3],
[1073982,440],
[1124793,3],
[1124793,440],
[855411,440],
[890704,440],
[1149809,440],
[860369,440],
[861652,440],
[1149668,440],
[885393,440],
[865573,440],
[1149980,440],
[1149979,440],
[1073506,3],
[1073506,440],
[1075403,3],
[1075403,440],
[1075501,3],
[1075501,440],
[1148896,3],
[1148896,440],
[1149444,440],
[1075574,3],
[1075574,440],
[1149442,3],
[1150011,3],
[1140788,440],
[1150120,440],
[861562,440],
[1149970,440],
[860108,3],
[1074628,440],
[1074628,3],
[929373,440],
[929374,440],
[885403,440],
[1148942,440],
[1148943,440],
[1148942,3],
[1148943,3],
[1073010,3],
[1073494,3],
[1074184,3],
[1075853,3],
[1073010,440],
[1073494,440],
[1074184,440],
[1075853,440],
[1149976,3],
[1073903,3],
[1075652,3],
[1073903,440],
[1075652,440],
[865462,440],
[1150174,440],
[929136,440],
[929137,440],
[929140,440],
[1150110,440],
[1150212,440],
[1073040,440],
[1073560,440],
[1074358,440],
[1075314,440],
[1073040,3],
[1073560,3],
[1074358,3],
[1075314,3],
[912076,440],
[1147478,440],
[1147473,3],
[1147473,440],
[1147480,3],
[1147480,440],
[1149800,440],
[1074667,3],
[1074667,440],
[864954,440],
[867968,440],
[1081725,440],
[1081725,3],
[864956,440],
[1104990,440],
[1104990,3],
[1118372,440],
[864955,440],
[929138,440],
[929139,440],
[929187,440],
[1150638,3],
[1150045,440],
[1150638,440],
[1073564,3],
[1074966,3],
[1075757,3],
[1073564,440],
[1074966,440],
[1075757,440],
[1150634,440],
[1150634,3],
[1149791,3],
[1147411,440],
[1072746,3],
[1073543,3],
[1075842,3],
[1072746,440],
[1073543,440],
[1075842,440],
[1109063,440],
[1073352,440],
[1073959,440],
[1074687,440],
[1073352,3],
[1073959,3],
[1074687,3],
[1098406,440],
[1074556,440],
[1074902,440],
[1074556,3],
[1074902,3],
[1109064,440],
[1109065,440],
[1076277,3],
[1076277,440],
[1074283,3],
[1074283,440],
[969698,440],
[1136442,440],
[1150846,440],
[1134560,3],
[1134560,440],
[1149779,440],
[1073154,440],
[1074032,440],
[1074218,440],
[1129748,440],
[1073154,3],
[1074032,3],
[1074218,3],
[1129748,3],
[864958,440],
[1039892,440],
[1093183,440],
[1140811,440],
[1150911,440],
[1073651,440],
[1148936,440],
[1073651,3],
[1148936,3],
[1093184,440],
[1097919,440],
[1150010,440],
[1141526,440],
[1141526,3],
[1150910,440],
[1150910,3],
[1073497,440],
[1150919,440],
[1073497,3],
[1150919,3],
[864780,440],
[1073022,3],
[1073022,440],
[1073460,3],
[1074519,3],
[1075061,3],
[1073460,440],
[1074519,440],
[1075061,440],
[1075785,440],
[899984,440],
[1150964,440],
[1075785,3],
[1072857,3],
[1072857,440],
[1073333,3],
[1073333,440],
[864957,440],
[1150861,440],
[1073988,440],
[1076156,440],
[1073988,3],
[1076258,440],
[1076156,3],
[1076258,3],
[1033864,440],
[1151364,440],
[1151364,3],
[1151371,440],
[1141715,3],
[1141715,440],
[969792,440],
[1073580,440],
[1148892,440]];

FOREACH STBANDDATA slice 1 IN ARRAY STDATA

LOOP

FOR STUDENTTRACKER_ROW IN 
Select st.* from studenttracker st, student std, organization org, enrollment e where 
st.activeflag=true and std.id=st.studentid and org.id=std.stateid and org.pooltype='MULTIEEOFC'
and e.studentid=std.id 
and std.id = STBANDDATA[1]
and st.contentareaid = STBANDDATA[2]


LOOP

select distinct e.currentgradelevel as gradecourseid, e.id as enrollmentid, e.currentschoolyear, e.studentid, 
e.attendanceschoolid, o.organizationname as attendanceschoolname, o.displayIdentifier as attendanceschoolidentifier,
gc.abbreviatedname as gradeCourseName, e.modifieddate, stu.legalfirstname, stu.legallastname
INTO ENROLLMENT_ROW from enrollment e 
inner join organization o on o.id=e.attendanceschoolid
inner join student stu on stu.id=e.studentid 
inner join gradecourse gc on gc.id=e.currentgradelevel
inner join enrollmentsrosters er on er.enrollmentid = e.id and er.activeflag is true
inner join roster r on r.id=er.rosterid and r.activeflag=true
where e.studentid=STUDENTTRACKER_ROW.studentid and e.activeflag is true
and e.currentschoolyear=2015
and (e.exitwithdrawaldate is null or (e.exitwithdrawaldate < e.schoolentrydate))
and r.currentschoolyear = 2015
and r.statesubjectareaid=STUDENTTRACKER_ROW.contentareaid
order by e.modifieddate desc limit 1;

ORGPOOLTYPE:=(select pooltype from organization where id=(select stateid from student where id=STUDENTTRACKER_ROW.studentid));

IF ORGPOOLTYPE='MULTIEEOFC' AND ENROLLMENT_ROW.gradeCourseName IN ('3','4','5','6','7','8') THEN

ORGPOOLTYPE:='MULTIEEOFG';

END IF;

ROSTERCOUNT:=(select count(*) from (select distinct r.*, course.name as coursename, course.abbreviatedname as courseabbreviatedname 
from roster r join enrollmentsrosters er on r.id = er.rosterid
left join gradecourse course on r.statecoursesid = course.id
where r.statesubjectareaid=STUDENTTRACKER_ROW.contentareaid
and r.currentschoolyear = 2015
and er.enrollmentid = ENROLLMENT_ROW.enrollmentid
and er.activeflag is true and r.activeflag is true
and r.sourcetype='TEST' and r.statecoursesid is not null) as temp1);

select distinct r.*, course.name as coursename, course.abbreviatedname as courseabbreviatedname 
INTO ROSTER_ROW
from roster r join enrollmentsrosters er on r.id = er.rosterid
left join gradecourse course on r.statecoursesid = course.id
where r.statesubjectareaid=STUDENTTRACKER_ROW.contentareaid
and r.currentschoolyear = 2015
and er.enrollmentid = ENROLLMENT_ROW.enrollmentid
and er.activeflag is true and r.activeflag is true
and r.sourcetype='TEST' and r.statecoursesid is not null order by r.id desc limit 1;

IF ROSTER_ROW is NULL THEN

ROSTERCOUNT:=(select count(*) from (select distinct r.*, course.name as coursename, course.abbreviatedname as courseabbreviatedname 
from roster r join enrollmentsrosters er on r.id = er.rosterid
left join gradecourse course on r.statecoursesid = course.id
where r.statesubjectareaid=STUDENTTRACKER_ROW.contentareaid
and r.currentschoolyear = 2015
and er.enrollmentid = ENROLLMENT_ROW.enrollmentid
and er.activeflag is true and r.activeflag is true
and r.statecoursesid is not null) as temp2);

select distinct r.*, course.name as coursename, course.abbreviatedname as courseabbreviatedname 
INTO ROSTER_ROW
from roster r join enrollmentsrosters er on r.id = er.rosterid
left join gradecourse course on r.statecoursesid = course.id
where r.statesubjectareaid=STUDENTTRACKER_ROW.contentareaid
and r.currentschoolyear = 2015
and er.enrollmentid = ENROLLMENT_ROW.enrollmentid
and er.activeflag is true and r.activeflag is true
and r.statecoursesid is not null order by r.id desc limit 1;

END IF;

select distinct ts.id, ts.externalid, ts.createdate, ts.modifieddate, ts.specificationname, 
ts.phase, ts.contentpool, ts.minimumnumberofees, ts.activeflag,
tc.gradebandid,tc.gradecourseid,tc.courseid,tc.contentareaid
INTO GRADETESTSPEC_ROW
from test t 
inner join testcollectionstests tct on t.id=tct.testid 
inner join testcollection tc on tc.id=tct.testcollectionid 
inner join testcollectionssessionrules tcsr on tcsr.testcollectionid=tc.id
inner join category srule on tcsr.sessionruleid = srule.id
inner join testspecification ts on t.testspecificationid = ts.id and ts.activeflag is true
inner join gradeband gb on tc.gradebandid = gb.id
inner join gradebandgradecourse gbgc on gbgc.gradebandid = tc.gradebandid
inner join gradecourse gc on gbgc.gradecourseid = gc.id
inner join category tstatus on t.status = tstatus.id
inner join assessmentstestcollections atc on atc.testcollectionid=tc.id
inner join assessment a on atc.assessmentid = a.id
inner join testingprogram tp on a.testingprogramid = tp.id
inner join assessmentprogram ap on tp.assessmentprogramid=ap.id
inner join operationaltestwindowstestcollections otwtc on otwtc.testcollectionid = tc.id
inner join operationaltestwindow otw on otw.id = otwtc.operationaltestwindowid
where tstatus.categorycode='DEPLOYED' and t.qccomplete is true
and tc.randomizationtype = 'enrollment' and tp.programabbr ='S' and ap.abbreviatedname='DLM'
and srule.categorycode='SYSTEM_DEFINED_ENROLLMENT_TO_TEST'
and (otw.effectivedate <= now() and now() <= otw.expirydate) AND (otw.suspendwindow is null or otw.suspendwindow=false)
and tc.phasetype = 'EOY' and tc.pooltype=ORGPOOLTYPE 
and gc.abbreviatedName=ROSTER_ROW.courseabbreviatedname and tc.contentareaid=STUDENTTRACKER_ROW.contentareaid 
order by ts.id limit 1;

IF GRADETESTSPEC_ROW IS NULL THEN

IF ORGPOOLTYPE='MULTIEEOFC' THEN

select distinct ts.id, ts.externalid, ts.createdate, ts.modifieddate, ts.specificationname, 
ts.phase, ts.contentpool, ts.minimumnumberofees, ts.activeflag,
tc.gradebandid,tc.gradecourseid,tc.courseid,tc.contentareaid
INTO GRADETESTSPEC_ROW
from test t 
inner join testcollectionstests tct on t.id=tct.testid 
inner join testcollection tc on tc.id=tct.testcollectionid 
inner join testcollectionssessionrules tcsr on tcsr.testcollectionid=tc.id
inner join category srule on tcsr.sessionruleid = srule.id
inner join testspecification ts on t.testspecificationid = ts.id and ts.activeflag is true
inner join gradecourse gc on tc.courseid = gc.id
inner join category tstatus on t.status = tstatus.id
inner join assessmentstestcollections atc on atc.testcollectionid=tc.id
inner join assessment a on atc.assessmentid = a.id
inner join testingprogram tp on a.testingprogramid = tp.id
inner join assessmentprogram ap on tp.assessmentprogramid=ap.id
inner join operationaltestwindowstestcollections otwtc on otwtc.testcollectionid = tc.id
inner join operationaltestwindow otw on otw.id = otwtc.operationaltestwindowid
where tstatus.categorycode='DEPLOYED' and t.qccomplete is true
and tc.randomizationtype = 'enrollment' and tp.programabbr ='S' and ap.abbreviatedname='DLM'
and srule.categorycode='SYSTEM_DEFINED_ENROLLMENT_TO_TEST'
and (otw.effectivedate <= now() and now() <= otw.expirydate) AND (otw.suspendwindow is null or otw.suspendwindow=false)
and tc.phasetype = 'EOY' and tc.pooltype=ORGPOOLTYPE 
and gc.abbreviatedName=ROSTER_ROW.courseabbreviatedname and tc.contentareaid=STUDENTTRACKER_ROW.contentareaid 
order by ts.id limit 1;

ELSE 

select distinct ts.id, ts.externalid, ts.createdate, ts.modifieddate, ts.specificationname, 
ts.phase, ts.contentpool, ts.minimumnumberofees, ts.activeflag,
tc.gradebandid,tc.gradecourseid,tc.courseid,tc.contentareaid
INTO GRADETESTSPEC_ROW
from test t 
inner join testcollectionstests tct on t.id=tct.testid 
inner join testcollection tc on tc.id=tct.testcollectionid 
inner join testcollectionssessionrules tcsr on tcsr.testcollectionid=tc.id
inner join category srule on tcsr.sessionruleid = srule.id
inner join testspecification ts on t.testspecificationid = ts.id and ts.activeflag is true
inner join gradecourse gc on tc.gradecourseid = gc.id
inner join category tstatus on t.status = tstatus.id
inner join assessmentstestcollections atc on atc.testcollectionid=tc.id
inner join assessment a on atc.assessmentid = a.id
inner join testingprogram tp on a.testingprogramid = tp.id
inner join assessmentprogram ap on tp.assessmentprogramid=ap.id
inner join operationaltestwindowstestcollections otwtc on otwtc.testcollectionid = tc.id
inner join operationaltestwindow otw on otw.id = otwtc.operationaltestwindowid
where tstatus.categorycode='DEPLOYED' and t.qccomplete is true
and tc.randomizationtype = 'enrollment' and tp.programabbr ='S' and ap.abbreviatedname='DLM'
and srule.categorycode='SYSTEM_DEFINED_ENROLLMENT_TO_TEST'
and (otw.effectivedate <= now() and now() <= otw.expirydate) AND (otw.suspendwindow is null or otw.suspendwindow=false)
and tc.phasetype = 'EOY' and tc.pooltype=ORGPOOLTYPE 
and gc.abbreviatedName=ROSTER_ROW.courseabbreviatedname and tc.contentareaid=STUDENTTRACKER_ROW.contentareaid  
order by ts.id limit 1;

END IF;

END IF;

TESTSPECFLAG:='';
COURSEMISSPOSITION:=0;
STBANDGRADEID:=0;
STUDGRADEID:=0;

FOR STUDENTTRACKERBAND_ROW IN
Select * from studenttrackerband where studenttrackerid=STUDENTTRACKER_ROW.id and activeflag=true and modifieddate>='2015-03-13' order by id

LOOP 

IF TESTSPECFLAG<>'MISMATCH' THEN

COURSEMISSPOSITION:=COURSEMISSPOSITION+1;

END IF;

IF STUDENTTRACKERBAND_ROW.testsessionid is NOT NULL AND TESTSPECFLAG<>'MISMATCH' THEN

TESTSESSIONIDDATA:=STUDENTTRACKERBAND_ROW.testsessionid;

select distinct ts.id, ts.externalid, ts.createdate, ts.modifieddate, ts.specificationname, 
ts.phase, ts.contentpool, ts.minimumnumberofees, ts.activeflag,
tc.gradebandid,tc.gradecourseid,tc.courseid,tc.contentareaid
INTO STBANDTESTSPEC_ROW 
from test t 
inner join testcollectionstests tct on t.id=tct.testid 
inner join testcollection tc on tc.id=tct.testcollectionid 
inner join testspecification ts on t.testspecificationid = ts.id and ts.activeflag is true
inner join studentstests sts on sts.testid=t.id
where sts.testsessionid=STUDENTTRACKERBAND_ROW.testsessionid;

IF STBANDTESTSPEC_ROW.id<>GRADETESTSPEC_ROW.id THEN

TESTSPECFLAG:='MISMATCH';

IF ORGPOOLTYPE='MULTIEEOFC' THEN

STBANDGRADEID:=STBANDTESTSPEC_ROW.courseid;
STUDGRADEID:=GRADETESTSPEC_ROW.courseid;

ELSE 

STBANDGRADEID:=STBANDTESTSPEC_ROW.gradecourseid;
STUDGRADEID:=GRADETESTSPEC_ROW.gradecourseid;

END IF;

END IF;

END IF;

END LOOP;

IF TESTSPECFLAG='MISMATCH' THEN

COUNT:=COUNT+1;

select std.id,std.statestudentidentifier,
(select organizationname from organization where id=e.attendanceschoolid) as school,
(select organizationname from organization where id=(select parentorganizationid from organizationrelation
where organizationid=e.attendanceschoolid)) as district,
(select organizationname from organization where id=std.stateid) as state,
au.id as teacherid, au.email INTO STUDINFO_ROW
from student std, enrollment e, testsession ts, roster r, aartuser au
where std.id=e.studentid and e.currentschoolyear=2015 and e.activeflag=true
and ts.rosterid=r.id and r.teacherid=au.id and ts.id=TESTSESSIONIDDATA
and r.activeflag=true
and std.id = STUDENTTRACKER_ROW.studentid limit 1;

STUDGRADE:=(select abbreviatedName from gradecourse where id=STUDGRADEID);
TESTGRADE:=(select abbreviatedName from gradecourse where id=STBANDGRADEID);

RAISE NOTICE '%,%,%,%,%,%,%,%,%,%,%,%',STUDENTTRACKER_ROW.studentid,STUDENTTRACKER_ROW.id,STUDENTTRACKER_ROW.contentareaid,STUDGRADE,TESTGRADE,COURSEMISSPOSITION,STUDINFO_ROW.statestudentidentifier,STUDINFO_ROW.school,STUDINFO_ROW.district,STUDINFO_ROW.state,STUDINFO_ROW.teacherid,STUDINFO_ROW.email;

FOR STUDENTTRACKERBAND_ROW1 IN
select stb.* from studenttrackerband stb
inner join studenttracker st on st.id=stb.studenttrackerid
where stb.activeflag=true and st.activeflag=true
and st.studentid=STUDENTTRACKER_ROW.studentid
and st.contentareaid=STUDENTTRACKER_ROW.contentareaid
and stb.modifieddate>='2015-03-13'

LOOP

STBAND_COUNT:=STBAND_COUNT+1;
--RAISE NOTICE 'Student Tracker Band Id, %',STUDENTTRACKERBAND_ROW1.id;

IF STUDENTTRACKERBAND_ROW1.testsessionid is not null THEN

--update studentstestsections set activeflag=false,modifieddate=CURRENT_TIMESTAMP where studentstestid in (select id from studentstests where testsessionid=STUDENTTRACKERBAND_ROW1.testsessionid);
--update studentstests set activeflag=false,modifieddate=CURRENT_TIMESTAMP where testsessionid=STUDENTTRACKERBAND_ROW1.testsessionid;
--update testsession set activeflag=false,modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.testsessionid;

END IF;

--update studenttrackerband set activeflag=false,modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.id;
--update studenttracker set status='UNTRACKED',modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.studenttrackerid;

END LOOP;

ELSE 

IF ROSTERCOUNT>1 THEN

COUNT:=COUNT+1;

select std.id,std.statestudentidentifier,
(select organizationname from organization where id=e.attendanceschoolid) as school,
(select organizationname from organization where id=(select parentorganizationid from organizationrelation
where organizationid=e.attendanceschoolid)) as district,
(select organizationname from organization where id=std.stateid) as state,
au.id as teacherid, au.email INTO STUDINFO_ROW
from student std, enrollment e, testsession ts, roster r, aartuser au
where std.id=e.studentid and e.currentschoolyear=2015 and e.activeflag=true
and ts.rosterid=r.id and r.teacherid=au.id and ts.id=TESTSESSIONIDDATA
and r.activeflag=true
and std.id = STUDENTTRACKER_ROW.studentid limit 1;

STUDGRADE:=(select abbreviatedName from gradecourse where id=STUDGRADEID);
TESTGRADE:=(select abbreviatedName from gradecourse where id=STBANDGRADEID);

--RAISE NOTICE '%,%,%,%,%,%,%,%,%,%,%,%',STUDENTTRACKER_ROW.studentid,STUDENTTRACKER_ROW.id,STUDENTTRACKER_ROW.contentareaid,STUDGRADE,TESTGRADE,COURSEMISSPOSITION,STUDINFO_ROW.statestudentidentifier,STUDINFO_ROW.school,STUDINFO_ROW.district,STUDINFO_ROW.state,STUDINFO_ROW.teacherid,STUDINFO_ROW.email;

FOR STUDENTTRACKERBAND_ROW1 IN
select stb.* from studenttrackerband stb
inner join studenttracker st on st.id=stb.studenttrackerid
where stb.activeflag=true and st.activeflag=true
and st.studentid=STUDENTTRACKER_ROW.studentid
and st.contentareaid=STUDENTTRACKER_ROW.contentareaid
and stb.modifieddate>='2015-03-13'

LOOP

STBAND_COUNT:=STBAND_COUNT+1;
--RAISE NOTICE 'Student Tracker Band Id, %',STUDENTTRACKERBAND_ROW1.id;

IF STUDENTTRACKERBAND_ROW1.testsessionid is not null THEN

update studentstestsections set activeflag=false,modifieddate=CURRENT_TIMESTAMP where studentstestid in (select id from studentstests where testsessionid=STUDENTTRACKERBAND_ROW1.testsessionid);
update studentstests set activeflag=false,modifieddate=CURRENT_TIMESTAMP where testsessionid=STUDENTTRACKERBAND_ROW1.testsessionid;
update testsession set activeflag=false,modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.testsessionid;

END IF;

update studenttrackerband set activeflag=false,modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.id;
update studenttracker set status='UNTRACKED',modifieddate=CURRENT_TIMESTAMP where id=STUDENTTRACKERBAND_ROW1.studenttrackerid;

END LOOP;

END IF;

END IF;

END LOOP;

END LOOP;

--RAISE NOTICE 'Total Count, %',COUNT;
--RAISE NOTICE 'STB Count, %',STBAND_COUNT;

END$$;