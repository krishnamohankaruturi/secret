DO $$DECLARE

STUDENTTRACKERBAND_ROW RECORD;
STUDENTTEST_ROW RECORD;
STUDENTTRACKER_ROW RECORD;

BEGIN

FOR STUDENTTRACKERBAND_ROW IN
select stb.id,stb.testsessionid,st.status from studenttrackerband stb,studentstests st where stb.testsessionid=st.testsessionid 
and stb.activeflag=true and st.activeflag=true and st.testsessionid in (
1221735,
1221734,
1221633,
1221573,
1221572,
1221571,
1221570,
1221471,
1221468,
1221467,
1221466,
1221465,
1221464,
1221460,
1221459,
1221458,
1221457,
1221456,
1221388,
1221387,
1221386,
1221385,
1221384,
1221322,
1221321,
1221275,
1221273,
1221272,
1221271,
1221270,
1221177,
1221176,
1221175,
1221174,
1221153,
1221152,
1221150,
1221149,
1221148,
1221141,
1221139,
1221138,
1221137,
1221136,
1221124,
1221123,
1221122,
1220983,
1220982,
1220981,
1220980,
1220979,
1220978,
1220934,
1220930,
1220871,
1220870,
1220869,
1220868,
1220867,
1220866,
1220865,
1220864,
1220863,
1220862,
1220861,
1220860,
1220775,
1220772,
1220771,
1220769,
1220768,
1220767,
1220710,
1220709,
1220706,
1220705,
1220611,
1220610,
1220609,
1220607,
1220606,
1220605,
1220604,
1220603,
1220602,
1220601,
1220600,
1220599,
1220598,
1220597,
1220596,
1220595,
1220594,
1220593,
1220592,
1220591,
1220590,
1220589,
1220588,
1220587,
1220586,
1220584,
1220583,
1220582,
1220581,
1220580,
1220579,
1220578,
1220577,
1220572,
1220571,
1220570,
1220569,
1220568,
1220566,
1220565,
1220564,
1220563,
1220562,
1220561,
1220560,
1220559,
1220558,
1220557,
1220556,
1220555,
1220554,
1220553,
1220552,
1220551,
1220550,
1220549,
1220548,
1220547,
1220546,
1220545,
1220544,
1220543,
1220542,
1220541,
1220540,
1220539,
1220538,
1220537,
1220536,
1220535,
1220534,
1220533,
1220532,
1220531,
1220529,
1220528,
1220527,
1220526,
1220525,
1220524,
1220523,
1220522,
1220521,
1220520,
1220519,
1220518,
1220517,
1220516)

LOOP

IF STUDENTTRACKERBAND_ROW.status=84 THEN

RAISE NOTICE 'Student Tracker Band Id, %',STUDENTTRACKERBAND_ROW.id;
update studenttrackerband set activeflag=false where id=STUDENTTRACKERBAND_ROW.id;
update studentstestsections set activeflag=false where studentstestid in (select id from studentstests where testsessionid=STUDENTTRACKERBAND_ROW.testsessionid);
update studentstests set activeflag=false where testsessionid=STUDENTTRACKERBAND_ROW.testsessionid;
update testsession set activeflag=false where id=STUDENTTRACKERBAND_ROW.testsessionid;
update studenttracker set status='UNTRACKED' where id=STUDENTTRACKERBAND_ROW.studenttrackerid;

END IF;

END LOOP;

END$$;